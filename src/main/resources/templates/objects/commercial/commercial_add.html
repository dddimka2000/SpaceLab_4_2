<!DOCTYPE html>
<html
        lang="en"
        class="light-style layout-navbar-fixed layout-menu-fixed"
        layout:decorate="~{layout.html}" xmlns:layout="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <title data-translate="менеджер_комерційної_нерухомості"></title>
</head>
<body>
<section layout:fragment="content">

    <div class="content-wrapper">
        <div class="container-fluid">
            <br>
            <div class="d-flex justify-content-between">
                <h4 class="fw-bold" data-translate="main">Новый объект</h4>
                <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb" class="d-flex align-items-center">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/}" data-translate="breadcrumb.home">Главная</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/commercial}" data-translate="COMMERCIAL">Комерческая</a></li>
                        <li class="breadcrumb-item active" aria-current="page" data-translate="new_object">
                            Новый объект
                        </li>
                    </ol>
                </nav>
            </div>
            <hr style="margin-top: -5px">
            <br>
            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-home"
                            type="button" role="tab" aria-controls="pills-home" aria-selected="true" data-translate="address_section">Адрессная часть
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-profile"
                            type="button" role="tab" aria-controls="pills-profile" aria-selected="false" data-translate="main_section">Основное
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-contact"
                            type="button" role="tab" aria-controls="pills-contact" aria-selected="false" data-translate="gallery">Галерея
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                    <div class="row">
                        <div class="col-2">
                            <span data-translate="streetUK">Улица(UK)</span>
                            <input class="form-control" id="streetUkr">
                        </div>
                        <div class="col-2">
                            <span data-translate="street">Улица(RU)</span>
                            <input class="form-control" id="street">
                        </div>
                        <div class="col-2">
                            <span data-translate="streetENG">Улица(EN)</span>
                            <input class="form-control" id="streetEng">
                        </div>
                        <div class="col-2">
                            <span data-translate="topzone">Топозона</span>
                            <select id="zone"></select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-2">
                            <span data-translate="region_district">Обл. Район</span>
                            <select class="form-control" id="region"> </select>
                        </div>
                        <div class="col-2">
                            <span data-translate="city">Нас.пункт</span>
                            <select class="form-control" id="city" disabled></select>
                        </div>
                        <div class="col-2">
                            <span data-translate="district">Район</span>
                            <select class="form-control" id="district" disabled></select>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2">
                            <span data-translate="house_number">Номер дома</span>
                            <input type="text" class="form-control onlyNumber" id="houseNumber" placeholder="34">
                        </div>
                        <div class="col-2">
                            <span data-translate="section_building">Секция/корпус</span>
                            <input type="text" class="form-control onlyNumber" id="section" placeholder="34">
                        </div>
                        <div class="col-2">
                            <span data-translate="apartment_number">Номер помещения</span>
                            <input type="text" class="form-control onlyNumber" id="apartmentNumber" placeholder="34">
                        </div>
                        <div class="col-6 d-flex justify-content-start">
                            <button class="btn btn-info mt-4" style="width: auto; height: 40px; margin-right: 5px" onclick="checkAddress()" data-translate="check_address">Проверить адрес
                            </button>
                            <button class="btn btn-info mt-4" onclick="checkPhone(this)" style="width: auto; height: 40px;" data-translate="check_phone_number">Проверить
                                номер телефона</span>
                            </button>
                        </div>

                    </div>
                    <br>
                    <div class="row">
                        <div class="col-3">
                            <span data-translate="enter_owner_name">ФИО владельца</span>
                            <input class="form-control" type="text" id="ownerName" placeholder="Введите ФИО владельца">
                        </div>
                        <div class="col-3">
                            <span data-translate="enter_phone_number">Телефон</span>
                            <input type="tel" id="ownerPhone" class="form-control phone"
                                   placeholder="Введите номер телефона">
                        </div>
                        <div class="col-3">
                            <span data-translate="acquisition_date">Дата приобретения</span>
                            <input type="text" id="boughtDate" class="form-control flatpickr-datetime"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                        <div class="col-3">
                            <span data-translate="ownership_rights">Право собственности</span>
                            <select id="ownership"></select>
                        </div>
                    </div>
                    <br>
                    <span data-translate="important_notes">Важные заметки</span>
                    <input class="form-control" id="notes" type="text" placeholder="Введите заметки">
                    <br>
                    <span data-translate="cadastral_number">Кадастровий номер участка</span>
                    <input class="form-control onlyNumber" id="cadastralNumber" type="text" style="width: 40%"
                           placeholder="XXX XXX XXX">
                    <br>
                    <span data-translate="idea_plot">Назначение участка</span>
                    <input class="form-control" id="plotDescription" type="text" placeholder="Введите заметки">
                    <br>
                    <span data-translate="houses_files">Прикрепить файлы</span>
                    <input type="file" id="files" accept=".pdf" class="form-control" style="width: 40%" multiple>
                    <br>
                    <div id="block-for-file">
                    </div>
                    <br>
                    <h3 data-translate="administration_comment">Комментарий администратора</h3>
                    <textarea class="form-control" style="width: 100%; height: 300px" id="administrationComment"
                              placeholder="Введите комментарий"></textarea>
                    <br>
                </div>
                <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                    <div class="row">
                        <div class="col-3">
                            <span data-translate="publication_status">Статус публикации</span>
                            <select id="publicationStatus"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="object_code">Код объекта</span>
                            <input class="form-control onlyNumber" type="text" id="objectCode" placeholder="XX XXXX XX">
                        </div>
                        <div class="col-5">
                            <div class="row">
                                <div class="col-6" style="white-space: nowrap;">
                                    <span data-translate="branch_and_staff_code">Код филиала — Код сотрудника</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-3" style="text-align: right">
                                    <input class="form-control onlyNumber" id="branchCode" placeholder="Код филиала"
                                           name="codeBranch">
                                </div>
                                <div class="col-1">
                                    <span>—</span>
                                </div>
                                <div class="col-3">
                                    <input class="form-control onlyNumber" id="staffCode" name="codeStaff"
                                           placeholder="Код сотрудника">
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2">
                            <span data-translate="price">Цена</span>
                            <input class="form-control onlyNumber" type="text" id="price"
                                   placeholder="Введите цену">
                        </div>
                        <div class="col-2">
                            <span data-translate="landmark">Ориентир</span>
                            <input class="form-control" type="text" id="landmark"
                                   placeholder="Введите ориентир">
                        </div>
                        <div class="col-2">
                            <span data-translate="RC">ЖК</span>
                            <select id="builderObject"></select>
                        </div>
                        <div class="col-2">
                            <span data-translate="completion_date">Срок здачи</span>
                            <select id="buildStatus"></select>
                        </div>
                        <div class="col-2">
                            <span data-translate="dateDeliveryHouse">Дата сдачи дома</span>
                            <input type="text" class="form-control flatpickr-datetime" id="dateDeliveryHouse"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2">
                            <span data-translate="floor">Етаж</span>
                            <input class="form-control onlyNumber" id="floor" placeholder="12">
                        </div>
                        <div class="col-2">
                            <span data-translate="floors">Етажность</span>
                            <input class="form-control onlyNumber" id="floorQuantity" placeholder="12">
                        </div>
                        <div class="col-2">
                            <span data-translate="room_quantity">Помещений</span>
                            <input class="form-control onlyNumber" id="roomQuantity" placeholder="12">
                        </div>
                        <div class="col-2">
                            <span data-translate="property_type">Тип недвижимости</span>
                            <select id="propertyCommercialType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-1">
                            <input class="form-check-input" type="checkbox" value="true" id="vnp" name="statusVNP">
                            <span class="checkmark" data-translate="vnp"> ВНП</span>
                        </div>
                        <div class="col-2">
                            <span data-translate="vnpExpirationDate">Дата внп до</span>
                            <input type="text" class="form-control flatpickr-datetime" id="vnpExpirationDate"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                        <div class="col-3">
                            <span data-translate="informationSource">Источник информации</span>
                                <input type="text" class="form-control" id="informationSource"
                                       placeholder="Введите источник информации">
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-2">
                            <span data-translate="S_total_area_sqm">S общая (м.кв.)*</span>
                            <input class="form-control onlyNumber" id="areaTotal"
                                   placeholder="Введите общую площадь">
                        </div>
                        <div class="col-2">
                            <span data-translate="areaUseful"> полезная (м.кв.)</span>
                            <input class="form-control onlyNumber" id="areaUseful"
                                   placeholder="Введите общую площадь">
                        </div>
                        <div class="col-2">
                            <span data-translate="room_square">Метражи помещений</span>
                            <input class="form-control onlyNumber" id="roomMeters"
                                   placeholder="Введите высоту потолка">
                        </div>
                        <div class="col-2">
                            <span data-translate="ceiling_height(m)">Высота потолка (м)</span>
                            <input class="form-control onlyNumber" id="heightCeiling"
                                   placeholder="Введите высоту потолка">
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-2">
                            <span data-translate="plotAreaTotal">S участка.(сот)</span>
                            <input class="form-control onlyNumber" id="plotAreaTotal" placeholder="12">
                        </div>
                        <div class="col-2">
                            <span data-translate="plotAreaFree">S уч.свободно(сот)</span>
                            <input class="form-control onlyNumber" id="plotAreaFree" placeholder="12">
                        </div>
                        <div class="col-2">
                            <span data-translate="idea_plot">Целевое назначение земли</span>
                            <select id="plotPurposeType"></select>
                        </div>
                        <div class="col-2">
                            <span data-translate="landOwnershipPresent">Собственость на землю</span>
                            <select id="landOwnershipPresent">
                                <option value="true">есть</option>
                                <option value="false">нет</option>
                            </select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            <span data-translate="stateInterior">Состояние интерьера</span>
                            <select id="stateInterior"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="propertyStructureState">Состояние строения</span>
                            <select id="propertyStructureState"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="bathroomType">Санузел</span>
                            <select id="bathroomType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="window_view">Вид с окна</span>
                            <select id="windowViewType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="environment">
                            <span class="checkmark" data-translate="environment">С обстановкой</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="parking">
                            <span class="checkmark" data-translate="parking">Есть парковка</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="fund">
                            <span class="checkmark" data-translate="fund">Жилой фонд</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="facade">
                            <span class="checkmark" data-translate="facade">фасад</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="railway">
                            <span class="checkmark" data-translate="railway">ЖД пути</span>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            <span data-translate="GAS">Газ</span>
                            <select id="gasType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="waterType">Вода</span>
                            <select id="waterType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="sewageType">Канализация</span>
                            <select id="sewageType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="heatingType">Отопление</span>
                            <select id="heatingType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            <span data-translate="main">Кондиционер</span>
                            <select id="airConditioningType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="main">Вентиляция</span>
                            <select id="ventilationType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="ladderType">Лестница</span>
                            <select id="ladderType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="main">Електричество</span>
                            <select id="electricityType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            <span data-translate="floorType">Пол</span>
                            <select id="floorType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="windowType">Тип окон</span>
                            <select id="windowType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="carpentryType">Столярка</span>
                            <select id="carpentryType"></select>
                        </div>
                        <div class="col-3">
                            <span data-translate="frontDoorType">Входная дверь</span>
                            <select id="frontDoorType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            <span data-translate="lastContactDate">Дата последнего контакта</span>
                            <input type="text" class="form-control flatpickr-datetime" id="lastContactDate"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="bargain">
                            <span class="checkmark" data-translate="bargain">Торг</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="exclusive">
                            <span class="checkmark" data-translate="exclusive">Ексклюзив</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="urgent">
                            <span class="checkmark" data-translate="urgent">Срочно</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="free">
                            <span class="checkmark" data-translate="free">Свободная</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="open">
                            <span class="checkmark" data-translate="object_open">Объект открыт</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="intermediary">
                            <span class="checkmark" data-translate="from_mediator">От посредника</span>
                        </div>
                    </div>
                    <br>
                    <ul class="nav nav-pills mb-3" id="pills-block" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pills-for-uk" data-bs-toggle="pill"
                                    data-bs-target="#pills-uk"
                                    type="button" role="tab" aria-controls="pills-home" aria-selected="true">UK
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-for-ru" data-bs-toggle="pill"
                                    data-bs-target="#pills-ru"
                                    type="button" role="tab" aria-controls="pills-profile" aria-selected="false">RU
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-for-en" data-bs-toggle="pill"
                                    data-bs-target="#pills-en"
                                    type="button" role="tab" aria-controls="pills-contact" aria-selected="false">EN
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-blovk-content">
                        <div class="tab-pane fade show active" id="pills-uk" role="tabpanel"
                             aria-labelledby="pills-for-uk">
                            <span data-translate="description">Описание</span>
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="descriptionUk" placeholder="Введите описание"></textarea>
                            <br>
                            <span data-translate="advertising_title">Рекламный заголовок</span>
                            <input type="text" id="advertisementHeadlineUk" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            <span data-translate="advertising_text">Рекламный текст</span>
                            <textarea style="width: 100%; height: 300px" id="advertisementTextUk"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                        <div class="tab-pane fade show" id="pills-ru" role="tabpanel"
                             aria-labelledby="pills-for-ru">
                            <span data-translate="description">Описание</span>
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="description" placeholder="Введите описание"></textarea>
                            <br>
                            <span data-translate="advertising_title">Рекламный заголовок</span>
                            <input type="text" id="advertisementHeadline" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            <span data-translate="advertising_text">Рекламный текст</span>
                            <textarea style="width: 100%; height: 300px" id="advertisementText"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                        <div class="tab-pane fade show" id="pills-en" role="tabpanel"
                             aria-labelledby="pills-for-en">
                            <span data-translate="description">Описание</span>
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="descriptionEn" placeholder="Введите описание"></textarea>
                            <br>
                            <span data-translate="advertising_title">Рекламный заголовок</span>
                            <input type="text" id="advertisementHeadlineEn" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            <span data-translate="advertising_text">Рекламный текст</span>
                            <textarea style="width: 100%; height: 300px" id="advertisementTextEn"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                    </div>
                    <input class="form-check-input" type="checkbox" value="true" id="advertisementEnabled">
                    <span class="checkmark" data-translate="advertise">Рекламировать</span>
                    <br>
                </div>
                <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                    <div class="row">
                        <div class="col-12">
                            <div class="card-body">
                                <form action="/uploadFileInvestor" class="dropzone needsclick dz-clickable"
                                      id="my-dropzoneInvestor">
                                    <div class="dz-message needsclick">
                                        <span class="note needsclick"></span>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div style="text-align: right; margin: 20px">
                <button class="btn btn-submit" data-translate="cancel">Отмена</button>
                <span>
                <button class="btn btn-success" hx-trigger="click" onclick="sendForm()" data-translate="save">
                Сохранить </button>
            </span>
            </div>
        </div>
    </div>
    <script th:src="@{/vendor/libs/dropzone/dropzone.js}"></script>
    <script th:inline="javascript">
        let contextPathURL =/*[[@{/}]]*/'';

        function checkAddress() {
            cleanInputs()
            showBlockForAllBody(true)
            let streetUkr = $("#streetUkr").val();
            let url = contextPathURL + 'checkStreet';
            $.ajax({
                type: "GET",
                url: url,
                data: {
                    name: streetUkr
                },
                success: function (response, textStatus, xhr) {
                    if (xhr.status === 200) {
                        showToast(response, "success", 3000);
                    } else if (xhr.status === 400) {
                        showToast(response, "danger", 10000);
                    } else {
                        console.log("Необработанный статус ответа:", xhr.status);
                    }
                    showBlockForAllBody(false)
                },
                error: function (xhr, textStatus, error) {
                    if (xhr.status === 400) {
                        $("#streetUkr").css("border", "1px solid #ff0000")
                        if (languageSecondExample == 'eng') {
                            addText($("#streetUkr"), "The street is not correct");
                        } else if (languageSecondExample == 'ru') {
                            addText($("#streetUkr"), "Улица не корректна");
                        } else {
                            addText($("#streetUkr"), "Вулиця не коректна");
                        }
                    }
                    showBlockForAllBody(false)
                    console.log(error);
                }
            })
        }
    </script>
    <script>
        $(document).ready(function () {
            showBlockForAllBody(false)
            if(getLastDigitFromPath()) {
                $.ajax({
                    type: "Get",
                    url: '[[@{/commercial/getById/}]]' + getLastDigitFromPath(),
                    success: function (commercial) {
                        $("#houseNumber").val(commercial.address.houseNumber)
                        $("#section").val(commercial.address.section)
                        $("#apartmentNumber").val(commercial.apartmentNumber)
                        $("#street").val(commercial.address.street)
                        $("#streetEng").val(commercial.address.streetEng)
                        $("#streetUkr").val(commercial.address.streetUkr)
                        $("#ownerName").val(commercial.ownerName)
                        $("#ownerPhone").val(commercial.ownerPhone)
                        $("#boughtDate").val(commercial.boughtDate.replaceAll('-', '/'))
                        $("#notes").val(commercial.notes)
                        $("#cadastralNumber").val(commercial.cadastralNumber)
                        $("#plotDescription").val(commercial.plotDescription)
                        $("#administrationComment").val(commercial.administrationComment)

                        $("#objectCode").val(commercial.objectCode)
                        if(commercial.realtor){
                            if(commercial.realtor.branch)$("#branchCode").val(commercial.realtor.branch.code)
                            $("#staffCode").val(commercial.realtor.code)
                        }
                        $("#landmark").val(commercial.landmark)
                        $("#dateDeliveryHouse").val(commercial.dateDeliveryHouse.replaceAll('-', '/'))

                        $("#price").val(commercial.price)
                        $("#plotAreaTotal").val(commercial.plotAreaTotal)
                        $("#plotAreaFree").val(commercial.plotAreaFree)
                        $("#houseQuantity").val(commercial.houseQuantity)
                        $("#floor").val(commercial.floor)
                        $("#floorQuantity").val(commercial.floorQuantity)
                        $("#roomQuantity").val(commercial.roomQuantity)
                        $("#bedroomQuantity").val(commercial.bedroomQuantity)
                        $("#roomMeters").val(commercial.roomMeters)
                        $("#areaTotal").val(commercial.areaTotal)
                        $("#heightCeiling").val(commercial.heightCeiling)
                        $("#areaUseful").val(commercial.areaUseful)
                        $("#areaLiving").val(commercial.areaLiving)
                        $("#areaKitchen").val(commercial.areaKitchen)

                        $("#lastContactDate").val(commercial.lastContactDate.replaceAll('-', '/'));
                        $("#vnpExpirationDate").val(commercial.vnpExpirationDate.replaceAll('-', '/'))
                        $("#environment").prop('checked', commercial.environment)
                        $("#parking").prop('checked', commercial.parking)
                        $("#fund").prop('checked', commercial.fund)
                        $("#facade").prop('checked', commercial.facade)
                        $("#railway").prop('checked', commercial.railway)
                        $("#vnp").prop('checked', commercial.vnp)
                        $("#informationSource").val(commercial.informationSource)
                        $('#bargain').prop('checked', commercial.bargain);
                        $('#exclusive').prop('checked', commercial.exclusive);
                        $('#urgent').prop('checked', commercial.urgent);
                        $('#free').prop('checked', commercial.free);
                        $('#open').prop('checked', commercial.open);
                        $('#intermediary').prop('checked', commercial.intermediary);
                        $('#advertisementEnabled').prop('checked', commercial.advertisementEnabled);

                        $("#descriptionUk").val(commercial.descriptionUk)
                        $("#advertisementHeadlineUk").val(commercial.advertisementHeadlineUk)
                        $("#advertisementTextUk").val(commercial.advertisementTextUk)
                        $("#description").val(commercial.description)
                        $("#advertisementHeadline").val(commercial.advertisementHeadline)
                        $("#advertisementText").val(commercial.advertisementText)
                        $("#descriptionEn").val(commercial.descriptionEn)
                        $("#advertisementHeadlineEn").val(commercial.advertisementHeadlineEn)
                        $("#advertisementTextEn").val(commercial.advertisementTextEn)
                        $("#advertisementEnabled").val(commercial.advertisementEnabled)


                        forSelect2(commercial.address.zone, commercial.address.zone, "#zone", "/enum/topzone")
                        forSelect2(commercial.ownershipType, commercial.ownershipType, "#ownership", "/enum/ownership")
                        if(commercial.builderObject)forSelect2WithSearch(commercial.builderObject.id, commercial.builderObject.name, "#builderObject", "/builder_objects/for/select")
                        else forSelect2WithSearch(undefined, undefined, "#builderObject", "/builder_objects/for/select")
                        forSelect2(commercial.publicationStatus, commercial.publicationStatus, "#publicationStatus", "/enum/publicationStatus")
                        forSelect2(commercial.buildStatus, commercial.buildStatus, "#buildStatus", "/enum/buildStatus")
                        forSelect2(commercial.propertyCommercialType, commercial.propertyCommercialType, "#propertyCommercialType", "/enum/propertyCommercialType")
                        forSelect2(commercial.plotPurposeType, commercial.plotPurposeType, "#plotPurposeType", "/enum/plotPurposeType")
                        forSelect2(commercial.stateInterior, commercial.stateInterior, "#stateInterior", "/enum/stateHouse")
                        forSelect2(commercial.propertyStructureState, commercial.propertyStructureState, "#propertyStructureState", "/enum/propertyStructureState")
                        forSelect2(commercial.bathroomType, commercial.bathroomType, "#bathroomType", "/enum/bathroom")
                        forSelect2(commercial.windowViewType, commercial.windowViewType, "#windowViewType", "/enum/windowViewType")

                        forSelect2(commercial.gasType, commercial.gasType, "#gasType", "/enum/gas")
                        forSelect2(commercial.waterType, commercial.waterType, "#waterType", "/enum/water")
                        forSelect2(commercial.sewageType, commercial.sewageType, "#sewageType", "/enum/sewerage")
                        forSelect2(commercial.heatingType, commercial.heatingType, "#heatingType", "/enum/heating")


                        forSelect2(commercial.airConditioningType, commercial.airConditioningType, "#airConditioningType", "/enum/airConditioning")
                        forSelect2(commercial.ventilationType, commercial.ventilationType, "#ventilationType", "/enum/ventilation")
                        forSelect2(commercial.ladderType, commercial.ladderType, "#ladderType", "/enum/ladder")
                        forSelect2(commercial.electricityType, commercial.electricityType, "#electricityType", "/enum/electricity")


                        forSelect2(commercial.floorType, commercial.floorType, "#floorType", "/enum/floor")
                        forSelect2(commercial.windowType, commercial.windowType, "#windowType", "/enum/window")
                        forSelect2(commercial.carpentryType, commercial.carpentryType, "#carpentryType", "/enum/carpentryType")
                        forSelect2(commercial.frontDoorType, commercial.frontDoorType, "#frontDoorType", "/enum/frontDoorType")
                        addressSelect2(commercial)

                        for (let file of commercial.files) {
                            var blockForFile = $("#block-for-file");
                            var row = $("<div class='row'></div>");
                            var col1 = $("<div class='col-2'><a href='#' class='text-decoration-none'>"+removeBeforeFirstDot(file)+"</a></div>");
                            col1.find('a').on("click", function () {
                                downloadFileFrom(file);
                            });
                            var col2 = $("<div class='col'><a href='#' class='text-decoration-none for-delete'>х удалить</a></div>");
                            col2.find('a').on("click", function () {
                                deleteFile(this, file);
                            });
                            row.append(col1);
                            row.append(col2);
                            blockForFile.append(row);
                        }
                    }
                })
            }
            else {
                forSelect2(undefined, undefined, "#zone", "/enum/topzone")
                forSelect2(undefined, undefined, "#ownership", "/enum/ownership")
                forSelect2WithSearch(undefined, undefined, "#builderObject", "/builder_objects/for/select")
                forSelect2(undefined, undefined, "#publicationStatus", "/enum/publicationStatus")
                forSelect2(undefined, undefined, "#buildStatus", "/enum/buildStatus")
                forSelect2(undefined, undefined, "#propertyCommercialType", "/enum/propertyCommercialType")
                forSelect2(undefined, undefined, "#plotPurposeType", "/enum/plotPurposeType")
                forSelect2(undefined, undefined, "#stateInterior", "/enum/stateHouse")
                forSelect2(undefined, undefined, "#propertyStructureState", "/enum/propertyStructureState")
                forSelect2(undefined, undefined, "#bathroomType", "/enum/bathroom")
                forSelect2(undefined, undefined, "#windowViewType", "/enum/windowViewType")

                forSelect2(undefined, undefined, "#gasType", "/enum/gas")
                forSelect2(undefined, undefined, "#waterType", "/enum/water")
                forSelect2(undefined, undefined, "#sewageType", "/enum/sewerage")
                forSelect2(undefined, undefined, "#heatingType", "/enum/heating")


                forSelect2(undefined, undefined, "#airConditioningType", "/enum/airConditioning")
                forSelect2(undefined, undefined, "#ventilationType", "/enum/ventilation")
                forSelect2(undefined, undefined, "#ladderType", "/enum/ladder")
                forSelect2(undefined, undefined, "#electricityType", "/enum/electricity")


                forSelect2(undefined, undefined, "#floorType", "/enum/floor")
                forSelect2(undefined, undefined, "#windowType", "/enum/window")
                forSelect2(undefined, undefined, "#carpentryType", "/enum/carpentryType")
                forSelect2(undefined, undefined, "#frontDoorType", "/enum/frontDoorType")
                addressSelect2()
            }
            $('#landOwnershipPresent').select2({
                placeholder: translateValue('виберіть_обєкт'),
                language: languageForSelect2,
                minimumResultsForSearch: -1,
            })
            addressSelect2()
            changeLanguageNav(languageSecondExample)
        });
        function sendForm() {
            var formData = new FormData();
            if(!validAllInputs(formData))return
            var branchCode = $("#branchCode");
            var staffCode = $("#staffCode");
            showBlockForAllBody(true)
            $.ajax({
                type: 'GET',
                url: '[[@{/realtors/getByCode/}]]' + staffCode.val(),
                success: function (realtor) {
                    if (realtor == '') {
                        scrollToElement(staffCode)
                        if (languageSecondExample == 'eng') addText(staffCode,"No user found for this code")
                        else if (languageSecondExample == 'ru')addText(staffCode,"Пользователя по такому коду не найдено")
                        else addText(staffCode,"Користувача за таким кодом не знайдено")

                        staffCode.css("border", "1px solid #ff0000");
                    } else if (realtor.branch.code.toString() !== branchCode.val().toString()) {
                        scrollToElement(branchCode)
                        if (languageSecondExample == 'eng') addText(files,"The realtor does not belong to the specified branch")
                        else if (languageSecondExample == 'ru')addText(files,"Риэлтор не принадлежит указанному филиалу")
                        else addText(files,"Ріелтор не належить вказаному філіалу")
                        branchCode.css("border", "1px solid #ff0000");
                    } else {
                        validatePhoneNumberWithAjax($('#ownerPhone')).then(result => {
                            if (result) {
                                $.ajax({
                                    type: 'GET',
                                    url: '[[@{/object/checkCode}]]',
                                    data: {code: $("#objectCode").val()},
                                    success: function (response) {
                                        if(response && !getLastDigitFromPath(window.location.pathname)){
                                            if (languageSecondExample == 'eng') addText($("#objectCode"),"An object with this code already exists")
                                            else if (languageSecondExample == 'ru')addText($("#objectCode"),"Объект с таким кодом уже существует")
                                            else addText($("#objectCode"),"Об'єкт з таким кодом вже існує")

                                            $("#objectCode").css("border", "1px solid #ff0000")
                                            scrollToElement($("#objectCode"))
                                        }
                                        else {
                                            $.ajax({
                                                type: 'POST',
                                                url: '[[@{/commercial/add}]]',
                                                data: formData,
                                                headers: { 'X-XSRF-TOKEN': '[[${_csrf.token}]]' },
                                                contentType: false,
                                                processData: false,
                                                success: function (response) {
                                                    showToast(response.status, "success")
                                                    showBlockForAllBody(false)
                                                },
                                                error: function (xhr, status, error) {
                                                    if (xhr.status === 400) {
                                                        validDataFromResponse(xhr.responseJSON)
                                                    } else {
                                                        console.error('Помилка відправки файлів на сервер:', error);
                                                    }
                                                    showBlockForAllBody(false)
                                                }
                                            });
                                        }
                                    },
                                })
                            }
                        }).catch(error => {
                        })
                    }
                },
                error: function (error) {
                    console.error('Помилка відправки файлів на сервер:', error);
                    reject(false);
                    showBlockForAllBody(false)
                }
            });



        }
    </script>
    <script>
        var hadImage = false
        function deleteFile(button, url) {
            $('#confirmationModal').modal('show');

            $('.confirm-delete').on('click', function () {
                var rowElement = button.closest('.row');
                if (rowElement) {
                    rowElement.remove();
                }
                showBlockForAllBody(true)
                $.ajax({
                    type: "Delete",
                    url: '[[@{/commercial/deleteFile}]]',
                    data: {
                        id: getLastDigitFromPath(window.location.pathname),
                        url: url,
                    },
                    headers: { 'X-XSRF-TOKEN': '[[${_csrf.token}]]' },
                    success: function (response) {
                        showToast(response, "success")
                        showBlockForAllBody(false)
                    },
                });
                $('#confirmationModal').modal('hide');
                $('.confirm-delete').off('click');
            });
            $('#confirmationModal .close, #confirmationModal [data-dismiss="modal"]').on('click', function () {
                $('#confirmationModal').modal('hide');
                $('.confirm-delete').off('click');
            });
        }
        function downloadFileFrom(url) {
            showBlockForAllBody(true)
            $.ajax({
                type: "GET",
                url: "[[@{/users/download}]]",
                xhrFields: {
                    responseType: 'blob'
                },
                data: {
                    url: url
                },
                success: function (data) {
                    var blob = new Blob([data], {type: 'application/octet-stream'});
                    var filename = "file.pdf";

                    if (window.navigator.msSaveOrOpenBlob) {
                        window.navigator.msSaveOrOpenBlob(blob, filename);
                    } else {
                        var link = document.createElement('a');
                        link.href = window.URL.createObjectURL(blob);
                        link.download = filename;
                        link.click();
                    }
                    showBlockForAllBody(false)
                },
                error: function () {
                    console.log("Помилка завантаження файлу");
                }
            });
        }
        function checkPhone(button) {
            cleanInputs()
            validatePhoneNumberWithAjax($('#ownerPhone')).then(result => {
                if (result) {
                    showToast("Телефон коректний", "success")
                }
            }).catch(error => {
            })
        }
        function validAllInputs(formData){
            var isValidated = true
            cleanInputs()
            var streetUkr = $("#streetUkr");
            if (!validString("1", "100", streetUkr)) isValidated = false
            var street = $("#street");
            if (!validString("1", "100", street)) isValidated = false
            var streetEng = $("#streetEng");
            if (!validString("1", "100", streetEng)) isValidated = false
            var zone = $("#zone");
            if (!validSelect2(zone)) isValidated = false
            var region = $("#region");
            if (!validSelect2(region)) isValidated = false
            var city = $("#city");
            if (!validSelect2(city)) isValidated = false
            var district = $("#district");
            if (!validSelect2(district)) isValidated = false
            var houseNumber = $("#houseNumber");
            if (!validateNumber(1, 1000000, houseNumber)) isValidated = false
            var section = $("#section");
            if (!validateNumber(1, 1000, section)) isValidated = false
            var apartmentNumber = $("#apartmentNumber");
            if (!validateNumber(1, 100, apartmentNumber)) isValidated = false
            var ownerName = $("#ownerName");
            if (!validString("1", "100", ownerName)) isValidated = false
            var ownerPhone = $("#ownerPhone");
            if (!validatePhoneNumber(ownerPhone)) isValidated = false
            var boughtDate = $("#boughtDate");
            if (!validateDate(boughtDate)) isValidated = false
            var ownership = $("#ownership");
            if (!validSelect2(ownership)) isValidated = false
            var notes = $("#notes");
            if (!validString("1", "990", notes)) isValidated = false
            var cadastralNumber = $("#cadastralNumber");
            if (!validString("1", "12", cadastralNumber)) isValidated = false
            var plotDescription = $("#plotDescription");
            if (!validString("1", "100", plotDescription)) isValidated = false
            var files = $("#files");
            if (!getLastDigitFromPath(window.location.pathname)  &&  !validateFile('files', [".pdf"])) isValidated = false
            var administrationComment = $("#administrationComment");
            if (!validString("1", "990", administrationComment)) isValidated = false
            var publicationStatus = $("#publicationStatus");
            if (!validSelect2(publicationStatus)) isValidated = false
            var objectCode = $("#objectCode");
            if (!validString("1", "10", objectCode)) isValidated = false
            var branchCode = $("#branchCode");
            if (!validateNumber(1, 1000000, branchCode)) isValidated = false
            var staffCode = $("#staffCode");
            if (!validateNumber(1, 1000000, staffCode)) isValidated = false
            var price = $("#price");
            if (!validateNumber(1, 100000000, price)) isValidated = false
            var landmark = $("#landmark");
            if (!validString("1", "100", landmark)) isValidated = false
            var builderObject = $("#builderObject");
            if (!validSelect2(builderObject)) isValidated = false
            var buildStatus = $("#buildStatus");
            if (!validSelect2(buildStatus)) isValidated = false
            var dateDeliveryHouse = $("#dateDeliveryHouse");
            if (!validateDate(dateDeliveryHouse))isValidated = false
            var floor = $("#floor");
            if (!validateNumber(1, 1000000, floor)) isValidated = false
            var floorQuantity = $("#floorQuantity");
            if (!validateNumber(1, 1000000, floorQuantity)) isValidated = false
            var roomQuantity = $("#roomQuantity");
            if (!validateNumber(1, 1000000, roomQuantity)) isValidated = false
            var propertyCommercialType = $("#propertyCommercialType");
            if (!validSelect2(propertyCommercialType)) isValidated = false
            var vnp = $("#vnp");
            var vnpExpirationDate = $("#vnpExpirationDate");
            if (!validateDate(vnpExpirationDate))isValidated = false
            var informationSource = $("#informationSource");
            if (!validString("1", "100", informationSource)) isValidated = false
            var areaTotal = $("#areaTotal");
            if (!validateNumber(1, 1000000, areaTotal)) isValidated = false
            var areaUseful = $("#areaUseful");
            if (!validateNumber(1, 1000000, areaUseful)) isValidated = false
            var roomMeters = $("#roomMeters");
            if (!validString("1", "6", roomMeters)) isValidated = false
            var heightCeiling = $("#heightCeiling");
            if (!validateNumber(1, 10, heightCeiling)) isValidated = false
            var plotAreaTotal = $("#plotAreaTotal");
            if (!validateNumber(1, 1000000, plotAreaTotal)) isValidated = false
            var plotAreaFree = $("#plotAreaFree");
            if (!validateNumber(1, 1000000, plotAreaFree)) isValidated = false
            var plotPurposeType = $("#plotPurposeType");
            if (!validSelect2(plotPurposeType)) isValidated = false
            var landOwnershipPresent = $("#landOwnershipPresent");
            var stateInterior = $("#stateInterior");
            if (!validSelect2(stateInterior)) isValidated = false
            var propertyStructureState = $("#propertyStructureState")
            if (!validSelect2(propertyStructureState)) isValidated = false
            var bathroomType = $("#bathroomType");
            if (!validSelect2(bathroomType)) isValidated = false
            var windowViewType = $("#windowViewType");
            if (!validSelect2(windowViewType)) isValidated = false
            var environment = $("#environment");
            var parking = $("#parking");
            var fund = $("#fund");
            var facade = $("#facade");
            var railway = $("#railway");
            var gasType = $("#gasType");
            if (!validSelect2(gasType)) isValidated = false
            var waterType = $("#waterType");
            if (!validSelect2(waterType)) isValidated = false
            var sewageType = $("#sewageType");
            if (!validSelect2(sewageType)) isValidated = false
            var heatingType = $("#heatingType");
            if (!validSelect2(heatingType)) isValidated = false
            var airConditioningType = $("#airConditioningType");
            if (!validSelect2(airConditioningType)) isValidated = false
            var ventilationType = $("#ventilationType");
            if (!validSelect2(ventilationType)) isValidated = false
            var ladderType = $("#ladderType");
            if (!validSelect2(ladderType)) isValidated = false
            var electricityType = $("#electricityType");
            if (!validSelect2(electricityType)) isValidated = false
            var floorType = $("#floorType");
            if (!validSelect2(floorType)) isValidated = false
            var windowType = $("#windowType");
            if (!validSelect2(windowType)) isValidated = false
            var carpentryType = $("#carpentryType");
            if (!validSelect2(carpentryType)) isValidated = false
            var frontDoorType = $("#frontDoorType");
            if (!validSelect2(frontDoorType)) isValidated = false
            var lastContactDate = $("#lastContactDate");
            if (!validateDate(lastContactDate))isValidated = false
            var bargain = $("#bargain");
            var exclusive = $("#exclusive");
            var urgent = $("#urgent");
            var free = $("#free");
            var open = $("#open");
            var intermediary = $("#intermediary");
            var advertisementEnabled = $("#advertisementEnabled");
            var descriptionUk = $("#descriptionUk");
            if (!validString("1", "990", descriptionUk)) isValidated = false
            var advertisementHeadlineUk = $("#advertisementHeadlineUk");
            if (!validString("1", "300", advertisementHeadlineUk)) isValidated = false
            var advertisementTextUk = $("#advertisementTextUk");
            if (!validString("1", "990", advertisementTextUk)) isValidated = false
            var description = $("#description");
            if (!validString("1", "990", description)) isValidated = false
            var advertisementHeadline = $("#advertisementHeadline");
            if (!validString("1", "300", advertisementHeadline)) isValidated = false
            var advertisementText = $("#advertisementText");
            if (!validString("1", "990", advertisementText)) isValidated = false
            var descriptionEn = $("#descriptionEn");
            if (!validString("1", "990", descriptionEn)) isValidated = false
            var advertisementHeadlineEn = $("#advertisementHeadlineEn");
            if (!validString("1", "300", advertisementHeadlineEn)) isValidated = false
            var advertisementTextEn = $("#advertisementTextEn");
            if (!validString("1", "990", advertisementTextEn)) isValidated = false
            var pictures = myDropzone.getAcceptedFiles()
            if (pictures.length <= 0  &&  !hadImage) {
                activateListItem('#pills-contact-tab')
                showToast("Як мінімум одне фото повино бути завантажене в дропзону", "danger")
                isValidated = false
            }
            if(getLastDigitFromPath()){
                formData.append("id", getLastDigitFromPath());
            }
            formData.append("streetUkr", streetUkr.val());
            formData.append("street", street.val());
            formData.append("streetEng", streetEng.val());
            formData.append("zone", zone.val());
            formData.append("region", region.val());
            formData.append("city", city.val());
            formData.append("district", district.val());
            formData.append("houseNumber", houseNumber.val());
            formData.append("section", section.val());
            formData.append("apartmentNumber", apartmentNumber.val());
            formData.append("ownerName", ownerName.val());
            formData.append("ownerPhone", ownerPhone.val());
            formData.append("boughtDate", boughtDate.val());
            formData.append("ownershipType", ownership.val());
            formData.append("notes", notes.val());
            formData.append("cadastralNumber", cadastralNumber.val());
            formData.append("plotDescription", plotDescription.val());
            formData.append("administrationComment", administrationComment.val());
            formData.append("publicationStatus", publicationStatus.val());
            formData.append("objectCode", objectCode.val());
            formData.append("branchCode", branchCode.val());
            formData.append("staffCode", staffCode.val());
            formData.append("price", price.val());
            formData.append("landmark", landmark.val());
            formData.append("builderObject", builderObject.val());
            formData.append("buildStatus", buildStatus.val());
            formData.append("dateDeliveryHouse", dateDeliveryHouse.val());
            formData.append("floor", floor.val());
            formData.append("floorQuantity", floorQuantity.val());
            formData.append("roomQuantity", roomQuantity.val());
            formData.append("propertyCommercialType", propertyCommercialType.val());
            formData.append("vnp", vnp.val());
            formData.append("vnpExpirationDate", vnpExpirationDate.val());
            formData.append("informationSource", informationSource.val());
            formData.append("areaTotal", areaTotal.val());
            formData.append("areaUseful", areaUseful.val());
            formData.append("roomMeters", roomMeters.val());
            formData.append("heightCeiling", heightCeiling.val());
            formData.append("plotAreaTotal", plotAreaTotal.val());
            formData.append("plotAreaFree", plotAreaFree.val());
            formData.append("plotPurposeType", plotPurposeType.val());
            formData.append("landOwnershipPresent", landOwnershipPresent.val());
            formData.append("stateInterior", stateInterior.val());
            formData.append("propertyStructureState", propertyStructureState.val());
            formData.append("bathroomType", bathroomType.val());
            formData.append("windowViewType", windowViewType.val());
            formData.append("environment", environment.is(':checked'));
            formData.append("parking", parking.is(':checked'));
            formData.append("fund", fund.is(':checked'));
            formData.append("facade", facade.is(':checked'));
            formData.append("railway", railway.is(':checked'));
            formData.append("gasType", gasType.val());
            formData.append("waterType", waterType.val());
            formData.append("sewageType", sewageType.val());
            formData.append("heatingType", heatingType.val());
            formData.append("airConditioningType", airConditioningType.val());
            formData.append("ventilationType", ventilationType.val());
            formData.append("ladderType", ladderType.val());
            formData.append("electricityType", electricityType.val());
            formData.append("floorType", floorType.val());
            formData.append("windowType", windowType.val());
            formData.append("carpentryType", carpentryType.val());
            formData.append("frontDoorType", frontDoorType.val());
            formData.append("lastContactDate", lastContactDate.val());
            formData.append("bargain", bargain.is(':checked'));
            formData.append("exclusive", exclusive.is(':checked'));
            formData.append("urgent", urgent.is(':checked'));
            formData.append("free", free.is(':checked'));
            formData.append("open", open.is(':checked'));
            formData.append("intermediary", intermediary.is(':checked'));
            formData.append("advertisementEnabled", advertisementEnabled.val());
            formData.append("descriptionUk", descriptionUk.val());
            formData.append("advertisementHeadlineUk", advertisementHeadlineUk.val());
            formData.append("advertisementTextUk", advertisementTextUk.val());
            formData.append("description", description.val());
            formData.append("advertisementHeadline", advertisementHeadline.val());
            formData.append("advertisementText", advertisementText.val());
            formData.append("descriptionEn", descriptionEn.val());
            formData.append("advertisementHeadlineEn", advertisementHeadlineEn.val());
            formData.append("advertisementTextEn", advertisementTextEn.val());
            pictures.forEach(function (file) {
                formData.append('pictures', file)
            })
            var filesElement = files[0].files;
            for (var i = 0; i < filesElement.length; i++) {
                formData.append("files", filesElement[i]);
            }
            countError = 0
            if(isValidated  &&  !validAllNumberInput())isValidated = false
            return isValidated
        }
        function addressSelect2(house) {
            if (house) {
                $("#district").removeAttr("disabled");
                $("#city").removeAttr("disabled");
                forSelect2(house.address.region, house.address.region, "#region", "/enum/region")
                forSelect2(house.address.district, house.address.district, "#district", "/getDistrict/" + house.address.city)
                forSelect2(house.address.city, house.address.city, "#city", "/getCity/" + house.address.region)
            } else {
                $("#region").select2({
                    placeholder: translateValue('виберіть_обєкт'),
                    language: languageForSelect2,
                    minimumResultsForSearch: -1,
                    ajax: {
                        url: '[[@{/enum/region}]]',
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: translateValue(data.name)};
                                return {id: data, text: translateValue(data)};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            }
            $('#region').on('select2:select', function (e) {
                var element = e.params.data.id
                $("#city").empty();
                $("#city").removeAttr("disabled");

                $("#district").empty();
                $("#district").prop("disabled", true);

                $("#city").select2({
                    placeholder: translateValue('виберіть_обєкт'),
                    language: languageForSelect2,
                    minimumResultsForSearch: -1,
                    ajax: {
                        url: '[[@{/getCity/}]]' + element,
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: translateValue(data.name)};
                                return {id: data, text: translateValue(data)};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            });
            $('#city').on('select2:select', function (e) {
                var element = e.params.data.id
                $("#district").empty();
                $("#district").removeAttr("disabled");
                $("#district").select2({
                    placeholder: translateValue('виберіть_обєкт'),
                    language: languageForSelect2,
                    minimumResultsForSearch: -1,
                    ajax: {
                        url: '[[@{/getDistrict/}]]' + element,
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: translateValue(data.name)};
                                return {id: data, text: translateValue(data)};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            });
        }

        const previewTemplate = `<div class="dz-preview dz-file-preview">
    <div class="dz-details">
      <div class="dz-thumbnail">
        <img data-dz-thumbnail>
        <span class="dz-nopreview">No preview</span>
        <div class="dz-success-mark"></div>
        <div class="dz-error-mark"></div>
        <div class="dz-error-message"><span data-dz-errormessage></span></div>
        <div class="progress">
          <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuemin="0" aria-valuemax="1000" data-dz-uploadprogress></div>
        </div>
      </div>
      <div class="dz-filename" data-dz-name></div>
      <div class="dz-size" data-dz-size></div>
    </div>
    </div>`;
        let uploadedFiles = new Map();
        let oldImagesArray = [];
        let currentFiles = 0;
        var myDropzone = new Dropzone("#my-dropzoneInvestor", {
            url: "/uploadFileInvestor",
            acceptedFiles: ".jpg, .png, .icon, .jpeg",
            previewTemplate: previewTemplate,
            parallelUploads: 5,
            maxFilesize: 10,
            addRemoveLinks: true,
            maxFiles: 15,
            autoProcessQueue: true,
            success: function (file, response) {
                console.log("Файл загружен: " + file.name);
                console.log("Ответ сервера: " + response);
                console.log(currentFiles);
                console.log(myDropzone.maxFiles);
                currentFiles++;
                const imageElement = file.previewElement.querySelector("img[data-dz-thumbnail]");
                imageElement.src = file.dataURL;
            }
        })
        myDropzone.on('success', function (file, response) {
            console.log('Файл успешно загружен:', file.name);
            if (oldImagesArray.includes(file.name)) {
                uploadedFiles.set("wrr2142" + file.name, file);
            } else {
                uploadedFiles.set(file.name, file);
            }
        });
        myDropzone.on('removedfile', function (file) {
            console.log('Файл был удален:', file.name);
            currentFiles--;
            if (uploadedFiles.has(file.name)) {
                uploadedFiles.delete(file.name);
            } else {
                if (file.description) {
                    $.ajax({
                        url: "[[@{/commercial/deletePicture/}]]" + getLastDigitFromPath(window.location.pathname),
                        method: "Delete",
                        data: {
                            url: file.description,
                        },
                        headers: { 'X-XSRF-TOKEN': '[[${_csrf.token}]]' },
                        success: function (response) {
                            showToast(response, "success")
                        },
                        error: function (error) {
                            console.error("Помилка при отриманні списку файлів: ", error);
                        }
                    });
                }
                console.log('Файл не найден в uploadedFiles Map.');
                oldImagesArray = oldImagesArray.filter(function (item) {
                    return item !== file.name;
                });
                console.log(oldImagesArray);
            }
            updateDropzoneMaxFiles()
        });
        myDropzone.on("addedfile", function (file) {
            console.log("Начало загрузки файла: " + file.name);

        });
        myDropzone.on('queuecomplete', function () {
            console.log('Загрузка всех файлов завершена.');
        });
        if (getLastDigitFromPath(window.location.pathname)) {
            $.ajax({
                url: "[[@{/commercial/getPicture/}]]" + getLastDigitFromPath(window.location.pathname),
                method: "GET",
                success: function (files) {
                    if(files)hadImage = true
                    files.forEach(function (file) {
                        var mockFile = {
                            name: removeBeforeFirstDot(file.originUrl),
                            size: file.size,
                            description: file.originUrl
                        };
                        myDropzone.emit("addedfile", mockFile);
                        myDropzone.emit("thumbnail", mockFile, file.url);
                        myDropzone.emit("complete", mockFile);
                    });
                },
                error: function (error) {
                    console.error("Помилка при отриманні списку файлів: ", error);
                }
            });
        }

        function updateDropzoneMaxFiles() {
            const newMaxFiles = (15 - oldImagesArray.length);
            myDropzone.options.maxFiles = newMaxFiles;
        }
    </script>
</section>
</body>
</html>