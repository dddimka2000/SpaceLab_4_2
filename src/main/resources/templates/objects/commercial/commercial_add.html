<!DOCTYPE html>
<html
        lang="en"
        class="light-style layout-navbar-fixed layout-menu-fixed"
        layout:decorate="~{layout.html}" xmlns:layout="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <title>Content page</title>
</head>
<body>
<section layout:fragment="content">

    <div class="content-wrapper">
        <div class="container-fluid">
            <br>
            <div class="d-flex justify-content-between">
                <h4 class="fw-bold">Новый объект</h4>
                <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb" class="d-flex align-items-center">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/}">Главная</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/commercial}">Комерческая</a></li>
                        <li class="breadcrumb-item active" aria-current="page">
                            Новый объект
                        </li>
                    </ol>
                </nav>
            </div>
            <hr style="margin-top: -5px">
            <br>
            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-home"
                            type="button" role="tab" aria-controls="pills-home" aria-selected="true">Адрессная часть
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-profile"
                            type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Основное
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-contact"
                            type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Галерея
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                    <div class="row">
                        <div class="col-2">
                            Улица(UK)
                            <input class="form-control" id="streetUkr">
                        </div>
                        <div class="col-2">
                            Улица(RU)
                            <input class="form-control" id="street">
                        </div>
                        <div class="col-2">
                            Улица(EN)
                            <input class="form-control" id="streetEng">
                        </div>
                        <div class="col-2">
                            Топозона
                            <select id="zone"></select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-2">
                            Обл. Район
                            <select class="form-control" id="region"> </select>
                        </div>
                        <div class="col-2">
                            Нас.пункт
                            <select class="form-control" id="city" disabled></select>
                        </div>
                        <div class="col-2">
                            Район
                            <select class="form-control" id="district" disabled></select>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2">
                            Номер дома
                            <input type="text" class="form-control onlyNumber" id="houseNumber" placeholder="34">
                        </div>
                        <div class="col-2">
                            Секция/корпус
                            <input type="text" class="form-control onlyNumber" id="section" placeholder="34">
                        </div>
                        <div class="col-2">
                            Номер помещения
                            <input type="text" class="form-control onlyNumber" id="apartmentNumber" placeholder="34">
                        </div>
                        <div class="col-6 d-flex justify-content-start">
                            <button class="btn btn-info mt-4" style="width: auto; margin-right: 5px">Проверить адрес
                            </button>
                            <button class="btn btn-info mt-4" onclick="checkPhone(this)" style="width: auto">Проверить
                                номер телефона
                            </button>
                        </div>

                    </div>
                    <br>
                    <div class="row">
                        <div class="col-3">
                            ФИО владельца
                            <input class="form-control" type="text" id="ownerName" placeholder="Введите ФИО владельца">
                        </div>
                        <div class="col-3">
                            Телефон
                            <input type="tel" id="ownerPhone" class="form-control phone"
                                   placeholder="Введите номер телефона">
                        </div>
                        <div class="col-3">
                            Дата приобретения
                            <input type="text" id="boughtDate" class="form-control flatpickr-datetime"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                        <div class="col-3">
                            Право собственности
                            <select id="ownership"></select>
                        </div>
                    </div>
                    <br>
                    Важные заметки
                    <input class="form-control" id="notes" type="text" placeholder="Введите заметки">
                    <br>
                    Кадастровий номер участка
                    <input class="form-control" id="cadastralNumber" type="text" style="width: 40%"
                           placeholder="XXX XXX XXX">
                    <br>
                    Назначение участка
                    <input class="form-control" id="plotDescription" type="text" placeholder="Введите заметки">
                    <br>
                    Прикрепить файлы
                    <input type="file" id="files" accept=".pdf" class="form-control" style="width: 40%" multiple>
                    <br>
                    <div id="block-for-file">
                    </div>
                    <br>
                    <h3>Комментарий администратора</h3>
                    <textarea class="form-control" style="width: 100%; height: 300px" id="administrationComment"
                              placeholder="Введите комментарий"></textarea>
                    <br>
                </div>
                <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                    <div class="row">
                        <div class="col-3">
                            Статус публикации
                            <select id="publicationStatus"></select>
                        </div>
                        <div class="col-3">
                            Код объекта
                            <input class="form-control" type="text" id="objectCode" placeholder="XX XXXX XX">
                        </div>
                        <div class="col-5">
                            <div class="row">
                                <div class="col-6" style="white-space: nowrap;">
                                    Код филиала — Код сотрудника
                                </div>
                            </div>
                            <div class="row" style="display:flex; align-items: center">
                                <div class="col-3" style="text-align: right">
                                    <input class="form-control onlyNumber" id="branchCode" placeholder="Код филиала"
                                           name="codeBranch">
                                </div>
                                <div class="col-1">
                                    <span>—</span>
                                </div>
                                <div class="col-3">
                                    <input class="form-control onlyNumber" id="staffCode" name="codeStaff"
                                           placeholder="Код сотрудника">
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2">
                            Цена
                            <input class="form-control onlyNumber" type="text" id="price"
                                   placeholder="Введите цену">
                        </div>
                        <div class="col-2">
                            Ориентир
                            <input class="form-control" type="text" id="landmark"
                                   placeholder="Введите ориентир">
                        </div>
                        <div class="col-2">
                            ЖК
                            <select id="builderObject"></select>
                        </div>
                        <div class="col-2">
                            Срок здачи
                            <select id="buildStatus"></select>
                        </div>
                        <div class="col-2">
                            Дата сдачи дома
                            <input type="text" class="form-control flatpickr-datetime" id="dateDeliveryHouse"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2">
                            Етаж
                            <input class="form-control onlyNumber" id="floor" placeholder="12">
                        </div>
                        <div class="col-2">
                            Етажность
                            <input class="form-control onlyNumber" id="floorQuantity" placeholder="12">
                        </div>
                        <div class="col-2">
                            Помещений
                            <input class="form-control onlyNumber" id="roomQuantity" placeholder="12">
                        </div>
                        <div class="col-2">
                            Тип недвижимости
                            <select id="houseType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-1">
                            <input class="form-check-input" type="checkbox" value="true" id="vnp" name="statusVNP">
                            <span class="checkmark"> ВНП</span>
                        </div>
                        <div class="col-2">
                            Дата внп до
                            <input type="text" class="form-control flatpickr-datetime" id="vnpExpirationDate"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                        <div class="col-3">
                                Источник информации
                                <input type="text" class="form-control" id="informationSource"
                                       placeholder="Введите источник информации">
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-2">
                            S общая (м.кв.)*
                            <input class="form-control onlyNumber" id="areaTotal"
                                   placeholder="Введите общую площадь">
                        </div>
                        <div class="col-2">
                            S полезная (м.кв.)
                            <input class="form-control onlyNumber" id="areaUseful"
                                   placeholder="Введите общую площадь">
                        </div>
                        <div class="col-2">
                            Метражи помещений
                            <input class="form-control onlyNumber" id="roomMeters"
                                   placeholder="Введите высоту потолка">
                        </div>
                        <div class="col-2">
                            Высота потолка (м)
                            <input class="form-control onlyNumber" id="heightCeiling"
                                   placeholder="Введите высоту потолка">
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-2">
                            S участка.(сот)
                            <input class="form-control onlyNumber" id="plotAreaTotal" placeholder="12">
                        </div>
                        <div class="col-2">
                            S уч.свободно(сот)
                            <input class="form-control onlyNumber" id="plotAreaFree" placeholder="12">
                        </div>
                        <div class="col-2">
                            Целевое назначение земли
                            <select id="plotPurposeType"></select>
                        </div>
                        <div class="col-2">
                            Собственость на землю
                            <select id="landOwnershipPresent">
                                <option value="true">есть</option>
                                <option value="false">нет</option>
                            </select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            Состояние интерьера
                            <select id="stateInterior"></select>
                        </div>
                        <div class="col-3">
                            Состояние строения
                            <select id="propertyStructureState"></select>
                        </div>
                        <div class="col-3">
                            Санузел
                            <select id="bathroomType"></select>
                        </div>
                        <div class="col-3">
                            Вид с окна
                            <select id="windowViewType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="environment">
                            <span class="checkmark">С обстановкой</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="parking">
                            <span class="checkmark">Есть парковка</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="fund">
                            <span class="checkmark">Жилой фонд</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="facade">
                            <span class="checkmark">фасад</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="railway">
                            <span class="checkmark">ЖД пути</span>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            Газ
                            <select id="gasType"></select>
                        </div>
                        <div class="col-3">
                            Вода
                            <select id="waterType"></select>
                        </div>
                        <div class="col-3">
                            Канализация
                            <select id="sewageType"></select>
                        </div>
                        <div class="col-3">
                            Отопление
                            <select id="heatingType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            Кондиционер
                            <select id="airConditioningType"></select>
                        </div>
                        <div class="col-3">
                            Вентиляция
                            <select id="ventilationType"></select>
                        </div>
                        <div class="col-3">
                            Лестница
                            <select id="ladderType"></select>
                        </div>
                        <div class="col-3">
                            Електричество
                            <select id="electricityType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            Пол
                            <select id="floorType"></select>
                        </div>
                        <div class="col-3">
                            Тип окон
                            <select id="windowType"></select>
                        </div>
                        <div class="col-3">
                            Столярка
                            <select id="carpentryType"></select>
                        </div>
                        <div class="col-3">
                            Входная дверь
                            <select id="frontDoorType"></select>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-3">
                            Дата последнего контакта
                            <input type="text" class="form-control flatpickr-datetime" id="lastContactDate"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="bargain">
                            <span class="checkmark">Торг</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="exclusive">
                            <span class="checkmark">Ексклюзив</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="urgent">
                            <span class="checkmark">Срочно</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="free">
                            <span class="checkmark">Свободная</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="open">
                            <span class="checkmark">Объект открыт</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="intermediary">
                            <span class="checkmark">От посредника</span>
                        </div>
                    </div>
                    <br>
                    <ul class="nav nav-pills mb-3" id="pills-block" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pills-for-uk" data-bs-toggle="pill"
                                    data-bs-target="#pills-uk"
                                    type="button" role="tab" aria-controls="pills-home" aria-selected="true">UK
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-for-ru" data-bs-toggle="pill"
                                    data-bs-target="#pills-ru"
                                    type="button" role="tab" aria-controls="pills-profile" aria-selected="false">RU
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-for-en" data-bs-toggle="pill"
                                    data-bs-target="#pills-en"
                                    type="button" role="tab" aria-controls="pills-contact" aria-selected="false">EN
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-blovk-content">
                        <div class="tab-pane fade show active" id="pills-uk" role="tabpanel"
                             aria-labelledby="pills-for-uk">
                            Описание
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="descriptionUk" placeholder="Введите описание"></textarea>
                            <br>
                            Рекламный заголовок
                            <input type="text" id="advertisementHeadlineUk" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            Рекламный текст
                            <textarea style="width: 100%; height: 300px" id="advertisementTextUk"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                        <div class="tab-pane fade show" id="pills-ru" role="tabpanel"
                             aria-labelledby="pills-for-ru">
                            Описание
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="description" placeholder="Введите описание"></textarea>
                            <br>
                            Рекламный заголовок
                            <input type="text" id="advertisementHeadline" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            Рекламный текст
                            <textarea style="width: 100%; height: 300px" id="advertisementText"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                        <div class="tab-pane fade show" id="pills-en" role="tabpanel"
                             aria-labelledby="pills-for-en">
                            Описание
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="descriptionEn" placeholder="Введите описание"></textarea>
                            <br>
                            Рекламный заголовок
                            <input type="text" id="advertisementHeadlineEn" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            Рекламный текст
                            <textarea style="width: 100%; height: 300px" id="advertisementTextEn"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                    </div>
                    <input class="form-check-input" type="checkbox" value="true" id="advertisementEnabled">
                    <span class="checkmark">Рекламировать</span>
                    <br>
                </div>
                <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                    <div class="row">
                        <div class="col-12">
                            <div class="card-body">
                                <form action="/uploadFileInvestor" class="dropzone needsclick dz-clickable"
                                      id="my-dropzoneInvestor">
                                    <div class="dz-message needsclick">
                                        <span class="note needsclick"></span>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div style="text-align: right; margin: 20px">
                <button class="btn btn-submit">Отмена</button>
                <span>
                <button class="btn btn-success" hx-trigger="click" onclick="sendForm()">
                Сохранить </button>
            </span>
            </div>
        </div>
    </div>
    <script th:src="@{/vendor/libs/dropzone/dropzone.js}"></script>
    <script>
        $(document).ready(function () {
            if(getLastDigitFromPath()) {
                $.ajax({
                    type: "Get",
                    url: '[[@{/commercial/getById/}]]' + getLastDigitFromPath(),
                    success: function (commercial) {
                        $("#houseNumber").val(commercial.address.houseNumber)
                        $("#section").val(commercial.address.section)
                        $("#apartmentNumber").val(commercial.apartmentNumber)
                        $("#street").val(commercial.address.street)
                        $("#streetEng").val(commercial.address.streetEng)
                        $("#streetUkr").val(commercial.address.streetUkr)
                        $("#ownerName").val(commercial.ownerName)
                        $("#ownerPhone").val(commercial.ownerPhone)
                        $("#boughtDate").val(commercial.boughtDate.replaceAll('-', '/'))
                        $("#notes").val(commercial.notes)
                        $("#cadastralNumber").val(commercial.cadastralNumber)
                        $("#plotDescription").val(commercial.plotDescription)
                        $("#administrationComment").val(commercial.administrationComment)

                        $("#objectCode").val(commercial.objectCode)
                        if(commercial.realtor!==null){
                            $("#branchCode").val(commercial.realtor.branch.code)
                            $("#staffCode").val(commercial.realtor.code)
                        }
                        $("#landmark").val(commercial.landmark)
                        $("#dateDeliveryHouse").val(commercial.dateDeliveryHouse.replaceAll('-', '/'))

                        $("#price").val(commercial.price)
                        $("#plotAreaTotal").val(commercial.plotAreaTotal)
                        $("#plotAreaFree").val(commercial.plotAreaFree)
                        $("#houseQuantity").val(commercial.houseQuantity)
                        $("#floor").val(commercial.floor)
                        $("#floorQuantity").val(commercial.floorQuantity)
                        $("#roomQuantity").val(commercial.roomQuantity)
                        $("#bedroomQuantity").val(commercial.bedroomQuantity)
                        $("#roomMeters").val(commercial.roomMeters)
                        $("#areaTotal").val(commercial.areaTotal)
                        $("#heightCeiling").val(commercial.heightCeiling)
                        $("#areaUseful").val(commercial.areaUseful)
                        $("#areaLiving").val(commercial.areaLiving)
                        $("#areaKitchen").val(commercial.areaKitchen)

                        $("#lastContactDate").val(commercial.lastContactDate.replaceAll('-', '/'));
                        $("#vnpExpirationDate").val(commercial.vnpExpirationDate.replaceAll('-', '/'))
                        $("#environment").prop('checked', commercial.environment)
                        $("#parking").prop('checked', commercial.parking)
                        $("#fund").prop('checked', commercial.fund)
                        $("#facade").prop('checked', commercial.facade)
                        $("#railway").prop('checked', commercial.railway)
                        $("#vnp").prop('checked', commercial.vnp)
                        $("#informationSource").val(commercial.informationSource)
                        $('#bargain').prop('checked', commercial.bargain);
                        $('#exclusive').prop('checked', commercial.exclusive);
                        $('#urgent').prop('checked', commercial.urgent);
                        $('#free').prop('checked', commercial.free);
                        $('#open').prop('checked', commercial.open);
                        $('#intermediary').prop('checked', commercial.intermediary);
                        $('#advertisementEnabled').prop('checked', commercial.advertisementEnabled);

                        $("#descriptionUk").val(commercial.descriptionUk)
                        $("#advertisementHeadlineUk").val(commercial.advertisementHeadlineUk)
                        $("#advertisementTextUk").val(commercial.advertisementTextUk)
                        $("#description").val(commercial.description)
                        $("#advertisementHeadline").val(commercial.advertisementHeadline)
                        $("#advertisementText").val(commercial.advertisementText)
                        $("#descriptionEn").val(commercial.descriptionEn)
                        $("#advertisementHeadlineEn").val(commercial.advertisementHeadlineEn)
                        $("#advertisementTextEn").val(commercial.advertisementTextEn)
                        $("#advertisementEnabled").val(commercial.advertisementEnabled)


                        forSelect2(commercial.address.zone, commercial.address.zone, "#zone", "/enum/topzone")
                        forSelect2(undefined, undefined, "#ownership", "/enum/ownership")
                        forSelect2(commercial.ownershipType, commercial.ownershipType, "#ownership", "/enum/ownership")
                        forSelect2WithSearch(commercial.builderObject.id, commercial.builderObject.name, "#builderObject", "/builder_objects/for/select")
                        forSelect2(commercial.publicationStatus, commercial.publicationStatus, "#publicationStatus", "/enum/publicationStatus")
                        forSelect2(commercial.buildStatus, commercial.buildStatus, "#buildStatus", "/enum/buildStatus")
                        forSelect2(commercial.houseType, commercial.houseType, "#houseType", "/enum/propertyType")
                        forSelect2(commercial.plotPurposeType, commercial.plotPurposeType, "#plotPurposeType", "/enum/plotPurposeType")
                        forSelect2(commercial.stateInterior, commercial.stateInterior, "#stateInterior", "/enum/stateHouse")
                        forSelect2(commercial.propertyStructureState, commercial.propertyStructureState, "#propertyStructureState", "/enum/propertyStructureState")
                        forSelect2(commercial.bathroomType, commercial.bathroomType, "#bathroomType", "/enum/bathroom")
                        forSelect2(commercial.windowViewType, commercial.windowViewType, "#windowViewType", "/enum/windowViewType")

                        forSelect2(commercial.gasType, commercial.gasType, "#gasType", "/enum/gas")
                        forSelect2(commercial.waterType, commercial.waterType, "#waterType", "/enum/water")
                        forSelect2(commercial.sewageType, commercial.sewageType, "#sewageType", "/enum/sewerage")
                        forSelect2(commercial.heatingType, commercial.heatingType, "#heatingType", "/enum/heating")


                        forSelect2(commercial.airConditioningType, commercial.airConditioningType, "#airConditioningType", "/enum/airConditioning")
                        forSelect2(commercial.ventilationType, commercial.ventilationType, "#ventilationType", "/enum/ventilation")
                        forSelect2(commercial.ladderType, commercial.ladderType, "#ladderType", "/enum/ladder")
                        forSelect2(commercial.electricityType, commercial.electricityType, "#electricityType", "/enum/electricity")


                        forSelect2(commercial.floorType, commercial.floorType, "#floorType", "/enum/floor")
                        forSelect2(commercial.windowType, commercial.windowType, "#windowType", "/enum/window")
                        forSelect2(commercial.carpentryType, commercial.carpentryType, "#carpentryType", "/enum/carpentryType")
                        forSelect2(commercial.frontDoorType, commercial.frontDoorType, "#frontDoorType", "/enum/frontDoorType")
                        addressSelect2(commercial)

                        for (let file of commercial.files) {
                            var blockForFile = $("#block-for-file");
                            var row = $("<div class='row'></div>");
                            var col1 = $("<div class='col-2'><a href='#' class='text-decoration-none'>"+removeBeforeFirstDot(file)+"</a></div>");
                            col1.find('a').on("click", function () {
                                downloadFileFrom(file);
                            });
                            var col2 = $("<div class='col'><a href='#' class='text-decoration-none for-delete'>х удалить</a></div>");
                            col2.find('a').on("click", function () {
                                deleteFile(this, file);
                            });
                            row.append(col1);
                            row.append(col2);
                            blockForFile.append(row);
                        }
                    }
                })
            }else {
                forSelect2(undefined, undefined, "#zone", "/enum/topzone")
                forSelect2(undefined, undefined, "#ownership", "/enum/ownership")
                forSelect2WithSearch(undefined, undefined, "#builderObject", "/builder_objects/for/select")
                forSelect2(undefined, undefined, "#publicationStatus", "/enum/publicationStatus")
                forSelect2(undefined, undefined, "#buildStatus", "/enum/buildStatus")
                forSelect2(undefined, undefined, "#houseType", "/enum/propertyType")
                forSelect2(undefined, undefined, "#plotPurposeType", "/enum/plotPurposeType")
                forSelect2(undefined, undefined, "#stateInterior", "/enum/stateHouse")
                forSelect2(undefined, undefined, "#propertyStructureState", "/enum/propertyStructureState")
                forSelect2(undefined, undefined, "#bathroomType", "/enum/bathroom")
                forSelect2(undefined, undefined, "#windowViewType", "/enum/windowViewType")

                forSelect2(undefined, undefined, "#gasType", "/enum/gas")
                forSelect2(undefined, undefined, "#waterType", "/enum/water")
                forSelect2(undefined, undefined, "#sewageType", "/enum/sewerage")
                forSelect2(undefined, undefined, "#heatingType", "/enum/heating")


                forSelect2(undefined, undefined, "#airConditioningType", "/enum/airConditioning")
                forSelect2(undefined, undefined, "#ventilationType", "/enum/ventilation")
                forSelect2(undefined, undefined, "#ladderType", "/enum/ladder")
                forSelect2(undefined, undefined, "#electricityType", "/enum/electricity")


                forSelect2(undefined, undefined, "#floorType", "/enum/floor")
                forSelect2(undefined, undefined, "#windowType", "/enum/window")
                forSelect2(undefined, undefined, "#carpentryType", "/enum/carpentryType")
                forSelect2(undefined, undefined, "#frontDoorType", "/enum/frontDoorType")
                addressSelect2()
            }
            $('#landOwnershipPresent').select2({
                minimumResultsForSearch: -1,
            })
            addressSelect2()
            new Cleave("#cadastralNumber", {
                blocks: [3, 3, 3],
                numericOnly: true
            })
            new Cleave("#objectCode", {
                blocks: [2, 4, 2],
                numericOnly: true
            })
            new Cleave("#roomMeters", {
                blocks: [2, 2, 2, 2],
                numericOnly: true
            })
        });
        function sendForm() {
            var formData = new FormData();
            if(!validAllInputs(formData))return
            var branchCode = $("#branchCode");
            var staffCode = $("#staffCode");

            $.ajax({
                type: 'GET',
                url: '[[@{/realtors/getByCode/}]]' + staffCode.val(),
                success: function (realtor) {
                    if (realtor == '') {
                        showToast("Користувача за таким кодом не знайдено", "danger")
                        staffCode.css("border", "1px solid #ff0000");
                    } else if (realtor.branch.code.toString() !== branchCode.val().toString()) {
                        showToast("Ріелтор не належить вказаному філіалу", "danger")
                        branchCode.css("border", "1px solid #ff0000");
                    } else {
                        $.ajax({
                            type: 'POST',
                            url: '[[@{/commercial/add}]]',
                            data: formData,
                            contentType: false,
                            processData: false,
                            success: function (response) {
                                showToast(response, "success")
                            },
                            error: function (error) {
                                console.error('Помилка відправки файлів на сервер:', error);
                            }
                        });
                    }
                },
                error: function (error) {
                    console.error('Помилка відправки файлів на сервер:', error);
                    reject(false);
                }
            });



        }
    </script>
    <script>
        function deleteFile(button, url) {
            $('#confirmationModal').modal('show');

            $('.confirm-delete').on('click', function () {
                var rowElement = button.closest('.row');
                if (rowElement) {
                    rowElement.remove();
                }
                $.ajax({
                    type: "Delete",
                    url: '[[@{/commercial/deleteFile}]]',
                    data: {
                        id: getLastDigitFromPath(window.location.pathname),
                        url: url,
                    },
                    success: function (response) {
                        showToast(response, "success")
                    },
                });
                $('#confirmationModal').modal('hide');
                $('.confirm-delete').off('click');
            });
            $('#confirmationModal .close, #confirmationModal [data-dismiss="modal"]').on('click', function () {
                $('#confirmationModal').modal('hide');
                $('.confirm-delete').off('click');
            });
        }
        function downloadFileFrom(url) {
            $.ajax({
                type: "GET",
                url: "[[@{/users/download}]]",
                xhrFields: {
                    responseType: 'blob'
                },
                data: {
                    url: url
                },
                success: function (data) {
                    var blob = new Blob([data], {type: 'application/octet-stream'});
                    var filename = "file.pdf";

                    if (window.navigator.msSaveOrOpenBlob) {
                        window.navigator.msSaveOrOpenBlob(blob, filename);
                    } else {
                        var link = document.createElement('a');
                        link.href = window.URL.createObjectURL(blob);
                        link.download = filename;
                        link.click();
                    }
                },
                error: function () {
                    console.log("Помилка завантаження файлу");
                }
            });
        }
        function checkPhone(button){
            cleanInputs()
            if (validatePhoneNumber($('#ownerPhone')))showToast("Телефон коректний", "success")
        }
        function validAllInputs(formData){
            cleanInputs()
            var streetUkr = $("#streetUkr");
            if (!validString("1", "300", streetUkr)) return false
            var street = $("#street");
            if (!validString("1", "300", street)) return false
            var streetEng = $("#streetEng");
            if (!validString("1", "300", streetEng)) return false
            var zone = $("#zone");
            if (!validSelect2(zone)) return false
            var region = $("#region");
            if (!validSelect2(region)) return false
            var city = $("#city");
            if (!validSelect2(city)) return false
            var district = $("#district");
            if (!validSelect2(district)) return false
            var houseNumber = $("#houseNumber");
            if (!validateNumber(1, 1000000, houseNumber)) return false
            var section = $("#section");
            if (!validateNumber(1, 1000, section)) return false
            var apartmentNumber = $("#apartmentNumber");
            if (!validateNumber(1, 100, apartmentNumber)) return false
            var ownerName = $("#ownerName");
            if (!validString("1", "300", ownerName)) return false
            var ownerPhone = $("#ownerPhone");
            if (!validatePhoneNumber(ownerPhone)) return false
            var boughtDate = $("#boughtDate");
            if (!validateDate(boughtDate)) return false
            var ownership = $("#ownership");
            if (!validSelect2(ownership)) return false
            var notes = $("#notes");
            if (!validString("1", "990", notes)) return false
            var cadastralNumber = $("#cadastralNumber");
            if (!validString("9", "9", cadastralNumber)) return false
            var plotDescription = $("#plotDescription");
            if (!validString("1", "990", plotDescription)) return false
            var files = $("#files");
            if (!getLastDigitFromPath(window.location.pathname)  &&  !validateFile('files', [".pdf"])) return false
            var administrationComment = $("#administrationComment");
            if (!validString("1", "990", administrationComment)) return false
            var publicationStatus = $("#publicationStatus");
            if (!validSelect2(publicationStatus)) return false
            var objectCode = $("#objectCode");
            if (!validString("8", "8", objectCode)) return false
            var branchCode = $("#branchCode");
            if (!validateNumber(1, 1000000, branchCode)) return false
            var staffCode = $("#staffCode");
            if (!validateNumber(1, 1000000, staffCode)) return false
            var price = $("#price");
            if (!validateNumber(1, 100000000, price)) return false
            var landmark = $("#landmark");
            if (!validString("1", "500", landmark)) return false
            var builderObject = $("#builderObject");
            if (!validSelect2(builderObject)) return false
            var buildStatus = $("#buildStatus");
            if (!validSelect2(buildStatus)) return false
            var dateDeliveryHouse = $("#dateDeliveryHouse");
            if (!validateDate(dateDeliveryHouse))return false
            var floor = $("#floor");
            if (!validateNumber(1, 1000000, floor)) return false
            var floorQuantity = $("#floorQuantity");
            if (!validateNumber(1, 1000000, floorQuantity)) return false
            var roomQuantity = $("#roomQuantity");
            if (!validateNumber(1, 1000000, roomQuantity)) return false
            var houseType = $("#houseType");
            if (!validSelect2(houseType)) return false
            var vnp = $("#vnp");
            var vnpExpirationDate = $("#vnpExpirationDate");
            if (!validateDate(vnpExpirationDate))return false
            var informationSource = $("#informationSource");
            if (!validString("1", "300", informationSource)) return false
            var areaTotal = $("#areaTotal");
            if (!validateNumber(1, 1000000, areaTotal)) return false
            var areaUseful = $("#areaUseful");
            if (!validateNumber(1, 1000000, areaUseful)) return false
            var roomMeters = $("#roomMeters");
            if (!validString("8", "8", roomMeters)) return false
            var heightCeiling = $("#heightCeiling");
            if (!validateNumber(1, 10, heightCeiling)) return false
            var plotAreaTotal = $("#plotAreaTotal");
            if (!validateNumber(1, 1000000, plotAreaTotal)) return false
            var plotAreaFree = $("#plotAreaFree");
            if (!validateNumber(1, 1000000, plotAreaFree)) return false
            var plotPurposeType = $("#plotPurposeType");
            if (!validSelect2(plotPurposeType)) return false
            var landOwnershipPresent = $("#landOwnershipPresent");
            var stateInterior = $("#stateInterior");
            if (!validSelect2(stateInterior)) return false
            var propertyStructureState = $("#propertyStructureState")
            if (!validSelect2(propertyStructureState)) return false
            var bathroomType = $("#bathroomType");
            if (!validSelect2(bathroomType)) return false
            var windowViewType = $("#windowViewType");
            if (!validSelect2(windowViewType)) return false
            var environment = $("#environment");
            var parking = $("#parking");
            var fund = $("#fund");
            var facade = $("#facade");
            var railway = $("#railway");
            var gasType = $("#gasType");
            if (!validSelect2(gasType)) return false
            var waterType = $("#waterType");
            if (!validSelect2(waterType)) return false
            var sewageType = $("#sewageType");
            if (!validSelect2(sewageType)) return false
            var heatingType = $("#heatingType");
            if (!validSelect2(heatingType)) return false
            var airConditioningType = $("#airConditioningType");
            if (!validSelect2(airConditioningType)) return false
            var ventilationType = $("#ventilationType");
            if (!validSelect2(ventilationType)) return false
            var ladderType = $("#ladderType");
            if (!validSelect2(ladderType)) return false
            var electricityType = $("#electricityType");
            if (!validSelect2(electricityType)) return false
            var floorType = $("#floorType");
            if (!validSelect2(floorType)) return false
            var windowType = $("#windowType");
            if (!validSelect2(windowType)) return false
            var carpentryType = $("#carpentryType");
            if (!validSelect2(carpentryType)) return false
            var frontDoorType = $("#frontDoorType");
            if (!validSelect2(frontDoorType)) return false
            var lastContactDate = $("#lastContactDate");
            if (!validateDate(lastContactDate))return false
            var bargain = $("#bargain");
            var exclusive = $("#exclusive");
            var urgent = $("#urgent");
            var free = $("#free");
            var open = $("#open");
            var intermediary = $("#intermediary");
            var advertisementEnabled = $("#advertisementEnabled");
            var descriptionUk = $("#descriptionUk");
            if (!validString("1", "990", descriptionUk)) return false
            var advertisementHeadlineUk = $("#advertisementHeadlineUk");
            if (!validString("1", "300", advertisementHeadlineUk)) return false
            var advertisementTextUk = $("#advertisementTextUk");
            if (!validString("1", "990", advertisementTextUk)) return false
            var description = $("#description");
            if (!validString("1", "990", description)) return false
            var advertisementHeadline = $("#advertisementHeadline");
            if (!validString("1", "300", advertisementHeadline)) return false
            var advertisementText = $("#advertisementText");
            if (!validString("1", "990", advertisementText)) return false
            var descriptionEn = $("#descriptionEn");
            if (!validString("1", "990", descriptionEn)) return false
            var advertisementHeadlineEn = $("#advertisementHeadlineEn");
            if (!validString("1", "300", advertisementHeadlineEn)) return false
            var advertisementTextEn = $("#advertisementTextEn");
            if (!validString("1", "990", advertisementTextEn)) return false
            var pictures = myDropzone.getAcceptedFiles();
            pictures.forEach(function (file) {
                formData.append('pictures', file)
            })
            if (!getLastDigitFromPath(window.location.pathname)  &&  pictures.length <= 0) {
                showToast("Як мінімум одне фото повино бути завантажене в дропзону", "danger")
                return false
            }
            if(getLastDigitFromPath()){
                formData.append("id", getLastDigitFromPath());
            }
            formData.append("streetUkr", streetUkr.val());
            formData.append("street", street.val());
            formData.append("streetEng", streetEng.val());
            formData.append("zone", zone.val());
            formData.append("region", region.val());
            formData.append("city", city.val());
            formData.append("district", district.val());
            formData.append("houseNumber", houseNumber.val());
            formData.append("section", section.val());
            formData.append("apartmentNumber", apartmentNumber.val());
            formData.append("ownerName", ownerName.val());
            formData.append("ownerPhone", ownerPhone.val());
            formData.append("boughtDate", boughtDate.val());
            formData.append("ownershipType", ownership.val());
            formData.append("notes", notes.val());
            formData.append("cadastralNumber", cadastralNumber.val());
            formData.append("plotDescription", plotDescription.val());
            formData.append("administrationComment", administrationComment.val());
            formData.append("publicationStatus", publicationStatus.val());
            formData.append("objectCode", objectCode.val());
            formData.append("branchCode", branchCode.val());
            formData.append("staffCode", staffCode.val());
            formData.append("price", price.val());
            formData.append("landmark", landmark.val());
            formData.append("builderObject", builderObject.val());
            formData.append("buildStatus", buildStatus.val());
            formData.append("dateDeliveryHouse", dateDeliveryHouse.val());
            formData.append("floor", floor.val());
            formData.append("floorQuantity", floorQuantity.val());
            formData.append("roomQuantity", roomQuantity.val());
            formData.append("houseType", houseType.val());
            formData.append("vnp", vnp.val());
            formData.append("vnpExpirationDate", vnpExpirationDate.val());
            formData.append("informationSource", informationSource.val());
            formData.append("areaTotal", areaTotal.val());
            formData.append("areaUseful", areaUseful.val());
            formData.append("roomMeters", roomMeters.val());
            formData.append("heightCeiling", heightCeiling.val());
            formData.append("plotAreaTotal", plotAreaTotal.val());
            formData.append("plotAreaFree", plotAreaFree.val());
            formData.append("plotPurposeType", plotPurposeType.val());
            formData.append("landOwnershipPresent", landOwnershipPresent.val());
            formData.append("stateInterior", stateInterior.val());
            formData.append("propertyStructureState", propertyStructureState.val());
            formData.append("bathroomType", bathroomType.val());
            formData.append("windowViewType", windowViewType.val());
            formData.append("environment", environment.is(':checked'));
            formData.append("parking", parking.is(':checked'));
            formData.append("fund", fund.is(':checked'));
            formData.append("facade", facade.is(':checked'));
            formData.append("railway", railway.is(':checked'));
            formData.append("gasType", gasType.val());
            formData.append("waterType", waterType.val());
            formData.append("sewageType", sewageType.val());
            formData.append("heatingType", heatingType.val());
            formData.append("airConditioningType", airConditioningType.val());
            formData.append("ventilationType", ventilationType.val());
            formData.append("ladderType", ladderType.val());
            formData.append("electricityType", electricityType.val());
            formData.append("floorType", floorType.val());
            formData.append("windowType", windowType.val());
            formData.append("carpentryType", carpentryType.val());
            formData.append("frontDoorType", frontDoorType.val());
            formData.append("lastContactDate", lastContactDate.val());
            formData.append("bargain", bargain.is(':checked'));
            formData.append("exclusive", exclusive.is(':checked'));
            formData.append("urgent", urgent.is(':checked'));
            formData.append("free", free.is(':checked'));
            formData.append("open", open.is(':checked'));
            formData.append("intermediary", intermediary.is(':checked'));
            formData.append("advertisementEnabled", advertisementEnabled.val());
            formData.append("descriptionUk", descriptionUk.val());
            formData.append("advertisementHeadlineUk", advertisementHeadlineUk.val());
            formData.append("advertisementTextUk", advertisementTextUk.val());
            formData.append("description", description.val());
            formData.append("advertisementHeadline", advertisementHeadline.val());
            formData.append("advertisementText", advertisementText.val());
            formData.append("descriptionEn", descriptionEn.val());
            formData.append("advertisementHeadlineEn", advertisementHeadlineEn.val());
            formData.append("advertisementTextEn", advertisementTextEn.val());
            pictures.forEach(function (file) {
                formData.append('pictures', file)
            })
            var filesElement = files[0].files;
            for (var i = 0; i < filesElement.length; i++) {
                formData.append("files", filesElement[i]);
            }
            return true
        }
        function addressSelect2(house) {
            if (house) {
                $("#district").removeAttr("disabled");
                $("#city").removeAttr("disabled");
                forSelect2(house.address.region, house.address.region, "#region", "/enum/region")
                forSelect2(house.address.district, house.address.district, "#district", "/getDistrict/" + house.address.city)
                forSelect2(house.address.city, house.address.city, "#city", "/getCity/" + house.address.region)
            } else {
                $("#region").select2({
                    minimumResultsForSearch: -1,
                    placeholder: "Елемент",
                    ajax: {
                        url: '[[@{/enum/region}]]',
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: data.name};
                                return {id: data, text: data};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            }
            $('#region').on('select2:select', function (e) {
                var element = e.params.data.text
                $("#city").empty();
                $("#city").removeAttr("disabled");

                $("#district").empty();
                $("#district").prop("disabled", true);

                $("#city").select2({
                    minimumResultsForSearch: -1,
                    placeholder: "Елемент",
                    ajax: {
                        url: '[[@{/getCity/}]]' + element,
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: data.name};
                                return {id: data, text: data};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            });
            $('#city').on('select2:select', function (e) {
                var element = e.params.data.text
                $("#district").empty();
                $("#district").removeAttr("disabled");
                $("#district").select2({
                    minimumResultsForSearch: -1,
                    placeholder: "Елемент",
                    ajax: {
                        url: '[[@{/getDistrict/}]]' + element,
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: data.name};
                                return {id: data, text: data};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            });
        }

        const previewTemplate = `<div class="dz-preview dz-file-preview">
    <div class="dz-details">
      <div class="dz-thumbnail">
        <img data-dz-thumbnail>
        <span class="dz-nopreview">No preview</span>
        <div class="dz-success-mark"></div>
        <div class="dz-error-mark"></div>
        <div class="dz-error-message"><span data-dz-errormessage></span></div>
        <div class="progress">
          <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuemin="0" aria-valuemax="1000" data-dz-uploadprogress></div>
        </div>
      </div>
      <div class="dz-filename" data-dz-name></div>
      <div class="dz-size" data-dz-size></div>
    </div>
    </div>`;
        let uploadedFiles = new Map();
        let oldImagesArray = [];
        let currentFiles = 0;
        var myDropzone = new Dropzone("#my-dropzoneInvestor", {
            url: "/uploadFileInvestor",
            acceptedFiles: ".jpg, .png, .icon, .jpeg",
            previewTemplate: previewTemplate,
            parallelUploads: 5,
            maxFilesize: 10,
            addRemoveLinks: true,
            maxFiles: 15,
            autoProcessQueue: true,
            success: function (file, response) {
                console.log("Файл загружен: " + file.name);
                console.log("Ответ сервера: " + response);
                console.log(currentFiles);
                console.log(myDropzone.maxFiles);
                currentFiles++;
                const imageElement = file.previewElement.querySelector("img[data-dz-thumbnail]");
                imageElement.src = file.dataURL;
            }
        })
        myDropzone.on('success', function (file, response) {
            console.log('Файл успешно загружен:', file.name);
            if (oldImagesArray.includes(file.name)) {
                uploadedFiles.set("wrr2142" + file.name, file);
            } else {
                uploadedFiles.set(file.name, file);
            }
        });
        myDropzone.on('removedfile', function (file) {
            console.log('Файл был удален:', file.name);
            currentFiles--;
            if (uploadedFiles.has(file.name)) {
                uploadedFiles.delete(file.name);
            } else {
                if (file.description) {
                    $.ajax({
                        url: "[[@{/commercial/deletePicture/}]]" + getLastDigitFromPath(window.location.pathname),
                        method: "Delete",
                        data: {
                            url: file.description,
                        },
                        success: function (response) {
                            showToast(response, "success")
                        },
                        error: function (error) {
                            console.error("Помилка при отриманні списку файлів: ", error);
                        }
                    });
                }
                console.log('Файл не найден в uploadedFiles Map.');
                oldImagesArray = oldImagesArray.filter(function (item) {
                    return item !== file.name;
                });
                console.log(oldImagesArray);
            }
            updateDropzoneMaxFiles()
        });
        myDropzone.on("addedfile", function (file) {
            console.log("Начало загрузки файла: " + file.name);

        });
        myDropzone.on('queuecomplete', function () {
            console.log('Загрузка всех файлов завершена.');
        });
        if (getLastDigitFromPath(window.location.pathname)) {
            $.ajax({
                url: "[[@{/commercial/getPicture/}]]" + getLastDigitFromPath(window.location.pathname),
                method: "GET",
                success: function (files) {
                    files.forEach(function (file) {
                        var mockFile = {
                            name: removeBeforeFirstDot(file.originUrl),
                            size: file.size,
                            description: file.originUrl
                        };
                        myDropzone.emit("addedfile", mockFile);
                        myDropzone.emit("thumbnail", mockFile, file.url);
                        myDropzone.emit("complete", mockFile);
                    });
                },
                error: function (error) {
                    console.error("Помилка при отриманні списку файлів: ", error);
                }
            });
        }

        function updateDropzoneMaxFiles() {
            const newMaxFiles = (15 - oldImagesArray.length);
            myDropzone.options.maxFiles = newMaxFiles;
        }
    </script>
</section>
</body>
</html>