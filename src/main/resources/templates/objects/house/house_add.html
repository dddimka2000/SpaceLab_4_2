<!DOCTYPE html>
<html
        lang="en"
        class="light-style layout-navbar-fixed layout-menu-fixed"
        layout:decorate="~{layout.html}" xmlns:layout="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <title>Content page</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
<section layout:fragment="content">

    <div class="content-wrapper">
        <div class="container-fluid">
            <br>
            <div class="d-flex justify-content-between">
                <h4 class="fw-bold">Новый объект</h4>
                <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb" class="d-flex align-items-center">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/}">Главная</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/houses}">Дома и участки</a></li>
                        <li class="breadcrumb-item active" aria-current="page">
                            Новый объект
                        </li>
                    </ol>
                </nav>
            </div>
            <hr style="margin-top: -5px">
            <br>
            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-home"
                            type="button" role="tab" aria-controls="pills-home" aria-selected="true">Адрессная часть
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-profile"
                            type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Основное
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-contact"
                            type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Галерея
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                    <div class="row">
                        <div class="col-2">
                            Номер дома
                            <input type="text" class="form-control onlyNumber" id="houseNumber" placeholder="34">
                        </div>
                        <div class="col-2">
                            Обл. Район
                            <select class="form-control" id="region"> </select>
                        </div>
                        <div class="col-2">
                            Нас.пункт
                            <select class="form-control" id="city" disabled></select>
                        </div>
                        <div class="col-2">
                            Район
                            <select class="form-control" id="district" disabled></select>
                        </div>
                        <div class="col-2">
                            Улица(RU)
                            <input class="form-control" id="street">
                        </div>
                        <div class="col-2">
                            Топозона
                            <select id="topzone"></select>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col">
                            <button class="btn btn-info mt-4" style="width: auto; margin-right: 5px"
                                    onclick="checkAddress(this)">Проверить адрес
                            </button>
                        </div>
                        <div class="col">
                            <button class="btn btn-info mt-4" onclick="checkPhone(this)" style="width: auto">Проверить
                                номер телефона
                            </button>
                        </div>
                        <div class="col">
                            Улица(UK)
                            <input class="form-control" id="streetUkr">
                        </div>
                        <div class="col">
                            Улица(EN)
                            <input class="form-control" id="streetEng">
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-3">
                            ФИО владельца
                            <input class="form-control" type="text" id="owner" placeholder="Введите ФИО владельца">
                        </div>
                        <div class="col-3">
                            Телефон
                            <input type="tel" id="telephone" class="form-control phone"
                                   placeholder="Введите номер телефона">
                        </div>
                        <div class="col-3">
                            Дата приобретения
                            <input type="text" id="dateOfPurchase" class="form-control flatpickr-datetime"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                        <div class="col-3">
                            Право собственности
                            <select id="ownership"></select>
                        </div>
                    </div>
                    <br>
                    Важные заметки
                    <input class="form-control" id="note" type="text" placeholder="Введите заметки">
                    <br>
                    Кадастровий номер участка
                    <input class="form-control" id="cadastralNumber" type="text" style="width: 40%"
                           placeholder="XXX XXX XXX">
                    <br>
                    Назначение участка
                    <input class="form-control" id="ideaPlot" type="text" placeholder="Введите заметки">
                    <br>
                    Прикрепить файлы
                    <input type="file" id="housesFiles" accept=".pdf" class="form-control" style="width: 40%" multiple>
                    <br>
                    <div id="block-for-file">
                    </div>
                    <br>
                    <h3>Комментарий администратора</h3>
                    <textarea class="form-control" style="width: 100%; height: 300px" id="administrationComment"
                              placeholder="Введите комментарий"></textarea>
                    <br>
                </div>
                <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                    <div class="row">
                        <div class="col-3">
                            Статус публикации
                            <select id="publicationStatus"></select>
                        </div>
                        <div class="col-3">
                            Код объекта
                            <input class="form-control" type="text" id="codeObject" placeholder="XX XXXX XX">
                        </div>
                        <div class="col-5">
                            <div class="row">
                                <div class="col-6" style="white-space: nowrap;">
                                    Код филиала — Код сотрудника
                                </div>
                            </div>
                            <div class="row" style="display:flex; align-items: center">
                                <div class="col-3" style="text-align: right">
                                    <input class="form-control onlyNumber" id="codeBranch" placeholder="Код филиала"
                                           name="codeBranch">
                                </div>
                                <div class="col-1">
                                    <span>—</span>
                                </div>
                                <div class="col-3">
                                    <input class="form-control onlyNumber" id="codeStaff" name="codeStaff"
                                           placeholder="Код сотрудника">
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    Ориентир
                    <input class="form-control" style="width: 40%;" type="text" id="landmark"
                           placeholder="Введите ориентир">
                    <br>
                    Цена
                    <input class="form-control onlyNumber" style="width: 40%;" type="text" id="price"
                           placeholder="Введите цену">
                    <br>
                    <div class="row">
                        <div class="col-3">
                            Тип недвижимости
                            <select id="propertyType"></select>
                        </div>
                        <div class="col-2">
                            S уч.(сот)
                            <input class="form-control onlyNumber" id="plotAreaTotal" placeholder="12">
                        </div>
                        <div class="col-2">
                            S уч.свободно(сот)
                            <input class="form-control onlyNumber" id="plotAreaFree" placeholder="12">
                        </div>
                        <div class="col-2">
                            Собственость на землю
                            <select id="landOwnershipPresent">
                                <option value="true">есть</option>
                                <option value="false">нет</option>
                            </select>
                        </div>
                        <div class="col-3">
                            Целевое назначение земли
                            <select id="plotPurposeType"></select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-1">
                            Кол.домов
                            <input class="form-control onlyNumber" id="houseQuantity" placeholder="12">
                        </div>
                        <div class="col-1">
                            Етажей
                            <input class="form-control onlyNumber" id="floorQuantity" placeholder="12">
                        </div>
                        <div class="col-1">
                            Комнат
                            <input class="form-control onlyNumber" id="roomQuantity" placeholder="12">
                        </div>
                        <div class="col-1">
                            Спален
                            <input class="form-control onlyNumber" id="bedroomQuantity" placeholder="12">
                        </div>
                        <div class="col-2">
                            Высота потолка (м)
                            <input class="form-control onlyNumber" step="0.01" id="myNumberInput"
                                   placeholder="Введите высоту потолка">
                        </div>
                        <div class="col-2">
                            S общая (м.кв.)*
                            <input class="form-control onlyNumber" id="areaTotal"
                                   placeholder="Введите общую площадь">
                        </div>
                        <div class="col-2">
                            S жилая (м.кв.)*
                            <input class="form-control onlyNumber" id="areaLiving"
                                   placeholder="Введите жилую площадь">
                        </div>
                        <div class="col-2">
                            S кухни (м.кв.)*
                            <input class="form-control onlyNumber" id="areaKitchen"
                                   placeholder="Введите площадь кухни">
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2">
                            Материал стен(RU)
                            <input class="form-control" type="text" id="wall_material"
                                   placeholder="Введите материал стен">
                        </div>
                        <div class="col-2">
                            Материал стен(UK)
                            <input class="form-control" type="text" id="wall_materialUkr"
                                   placeholder="Введите материал стен">
                        </div>
                        <div class="col-2">
                            Материал стен(EN)
                            <input class="form-control" type="text" id="wall_materialEng"
                                   placeholder="Введите материал стен">
                        </div>
                        <div class="col-2">
                            Состояние интерьера
                            <select id="stateInterior"></select>
                        </div>
                        <div class="col-2">
                            Состояние дома
                            <select id="stateHouse"></select>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-3">
                            Кухня
                            <select id="kitchenType"></select>
                        </div>
                        <div class="col-3">
                            Санузел
                            <select id="bathroomType"></select>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-3">
                            Газ
                            <select id="gasType"></select>
                        </div>
                        <div class="col-3">
                            Вода
                            <select id="waterType"></select>
                        </div>
                        <div class="col-3">
                            Канализация
                            <select id="sewageType"></select>
                        </div>
                        <div class="col-3">
                            Отопление
                            <select id="heatingType"></select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            Лестница
                            <select id="ladderType"></select>
                        </div>
                        <div class="col-3">
                            Кровля
                            <select id="roofType"></select>
                        </div>
                        <div class="col-3">
                            Пол
                            <select id="floorType"></select>
                        </div>
                        <div class="col-3">
                            Тип окон
                            <select id="windowType"></select>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-3">
                            Столярка
                            <select id="carpentryType"></select>
                        </div>
                        <div class="col-3">
                            Входная дверь
                            <select id="frontDoorType"></select>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2" style="white-space: nowrap;">
                            Дата последнего контакта
                            <input type="text" class="form-control flatpickr-datetime" id="lastContactDate"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                        <div class="col-1" style="display: flex; align-items: end">
                            <input class="form-check-input" type="checkbox" value="true" id="vnp" name="statusVNP">
                            <span class="checkmark"> ВНП</span>
                        </div>
                        <div class="col-2">
                            Дата внп до
                            <input type="text" class="form-control flatpickr-datetime" id="vnpExpirationDate"
                                   placeholder="YYYY/MM/DD"/>
                        </div>
                        <div class="col-2">
                            Источник информации
                            <input type="text" class="form-control" id="informationSource"
                                   placeholder="Введите источник информации">
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="bargain">
                            <span class="checkmark">Торг</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="exclusive">
                            <span class="checkmark">Ексклюзив</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="urgent">
                            <span class="checkmark">Срочно</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="free">
                            <span class="checkmark">Свободная</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="open">
                            <span class="checkmark">Объект открыт</span>
                        </div>
                        <div class="col-2">
                            <input class="form-check-input" type="checkbox" id="intermediary">
                            <span class="checkmark">От посредника</span>
                        </div>
                    </div>
                    <br>
                    <ul class="nav nav-pills mb-3" id="pills-block" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pills-for-uk" data-bs-toggle="pill"
                                    data-bs-target="#pills-uk"
                                    type="button" role="tab" aria-controls="pills-home" aria-selected="true">UK
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-for-ru" data-bs-toggle="pill"
                                    data-bs-target="#pills-ru"
                                    type="button" role="tab" aria-controls="pills-profile" aria-selected="false">RU
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-for-en" data-bs-toggle="pill"
                                    data-bs-target="#pills-en"
                                    type="button" role="tab" aria-controls="pills-contact" aria-selected="false">EN
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-blovk-content">
                        <div class="tab-pane fade show active" id="pills-uk" role="tabpanel"
                             aria-labelledby="pills-for-uk">
                            Описание
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="descriptionUk" placeholder="Введите описание"></textarea>
                            <br>
                            Рекламный заголовок
                            <input type="text" id="advertisementHeadlineUk" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            Рекламный текст
                            <textarea style="width: 100%; height: 300px" id="advertisementTextUk"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                        <div class="tab-pane fade show" id="pills-ru" role="tabpanel" aria-labelledby="pills-for-ru">
                            Описание
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="descriptionRu" placeholder="Введите описание"></textarea>
                            <br>
                            Рекламный заголовок
                            <input type="text" id="advertisementHeadlineRu" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            Рекламный текст
                            <textarea style="width: 100%; height: 300px" id="advertisementTextRu"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                        <div class="tab-pane fade show" id="pills-en" role="tabpanel" aria-labelledby="pills-for-en">
                            Описание
                            <textarea class="form-control" style="width: 100%; height: 300px"
                                      id="descriptionEn" placeholder="Введите описание"></textarea>
                            <br>
                            Рекламный заголовок
                            <input type="text" id="advertisementHeadlineEn" class="form-control"
                                   placeholder="Укажите рекламный заголовок">
                            <br>
                            Рекламный текст
                            <textarea style="width: 100%; height: 300px" id="advertisementTextEn"
                                      class="form-control" placeholder="Введите рекламный текст"></textarea>
                            <br>
                        </div>
                    </div>
                    <input class="form-check-input" type="checkbox" value="true" id="advertisementEnabled">
                    <span class="checkmark">Рекламировать</span>
                    <br>
                </div>
                <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                    <div class="row">
                        <div class="col-12">
                            <div class="card-body">
                                <form action="/uploadFileInvestor" class="dropzone needsclick dz-clickable"
                                      id="my-dropzoneInvestor">
                                    <div class="dz-message needsclick">
                                        <span class="note needsclick"></span>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div style="text-align: right; margin: 20px">
                <button class="btn btn-submit">Отмена</button>
                <span>
                <button class="btn btn-success" hx-trigger="click" onclick="sendForm()">
                Сохранить </button>
            </span>
            </div>
        </div>
    </div>
    <script th:src="@{/vendor/libs/dropzone/dropzone.js}"></script>
    <script th:inline="javascript">
        let contextPathURL =/*[[@{/}]]*/'';

        function checkAddress() {
            let streetUkr = $("#streetUkr").val();
            console.log(streetUkr);
            let url = contextPathURL + 'checkStreet';
            $.ajax({
                type: "GET",
                url: url,
                data: {
                    name: streetUkr
                },
                success: function (response, textStatus, xhr) {
                    if (xhr.status === 200) {
                        showToast(response, "success");
                    } else if (xhr.status === 400) {
                        showToast(response, "danger");
                    } else {
                        console.log("Необработанный статус ответа:", xhr.status);
                    }
                },
                error: function (xhr, textStatus, error) {
                    if (xhr.status === 400) {
                        showToast(xhr.responseText, "danger");
                    }
                    console.log(error);
                }
            })
        }
    </script>
    <script>

        function checkPhone(button) {
            if (validatePhoneNumber($('#telephone'))) showToast("Телефон коректний", "success")
        }

        function deleteFile(button, url) {
            $('#confirmationModal').modal('show');

            $('.confirm-delete').on('click', function () {
                var rowElement = button.closest('.row');
                if (rowElement) {
                    rowElement.remove();
                }
                $.ajax({
                    type: "Delete",
                    url: '[[@{/houses/deleteFile}]]',
                    data: {
                        id: getLastDigitFromPath(window.location.pathname),
                        url: url,
                    },
                    success: function (response) {
                        showToast(response, "success")
                    },
                });
                $('#confirmationModal').modal('hide');
                $('.confirm-delete').off('click');
            });
            $('#confirmationModal .close, #confirmationModal [data-dismiss="modal"]').on('click', function () {
                $('#confirmationModal').modal('hide');
                $('.confirm-delete').off('click');
            });
        }

        function downloadFileFrom(url) {
            $.ajax({
                type: "GET",
                url: "[[@{/users/download}]]",
                xhrFields: {
                    responseType: 'blob'
                },
                data: {
                    url: url
                },
                success: function (data) {
                    var blob = new Blob([data], {type: 'application/octet-stream'});
                    var filename = "file.pdf";

                    if (window.navigator.msSaveOrOpenBlob) {
                        window.navigator.msSaveOrOpenBlob(blob, filename);
                    } else {
                        var link = document.createElement('a');
                        link.href = window.URL.createObjectURL(blob);
                        link.download = filename;
                        link.click();
                    }
                },
                error: function () {
                    console.log("Помилка завантаження файлу");
                }
            });
        }

        function validAllInput(formData) {
            cleanInputs()
            var houseNumber = $("#houseNumber")
            var region = $("#region")
            var city = $("#city")
            var district = $("#district")
            var street = $("#street")
            var streetUkr = $("#streetUkr")
            var streetEng = $("#streetEng")
            var zone = $("#topzone")
            var ownerName = $("#owner")
            var ownerPhone = $("#telephone")
            var boughtDate = $("#dateOfPurchase")
            var ownershipType = $("#ownership")
            var notes = $("#note")
            var cadastralNumber = $("#cadastralNumber")
            var plotDescription = $("#ideaPlot")
            var files = $("#housesFiles")
            var administrationComment = $("#administrationComment")
            if (getLastDigitFromPath(window.location.pathname))
                formData.append("id", getLastDigitFromPath(window.location.pathname));
            formData.append("houseNumber", houseNumber.val());
            formData.append("region", region.val());
            formData.append("city", city.val());
            formData.append("district", district.val());
            formData.append("street", street.val());
            formData.append("streetEng", streetEng.val());
            formData.append("streetUkr", streetUkr.val());
            formData.append("zone", zone.val());
            formData.append("ownerName", ownerName.val());
            formData.append("ownerPhone", ownerPhone.val());
            formData.append("boughtDate", boughtDate.val());
            formData.append("ownershipType", ownershipType.val());
            formData.append("notes", notes.val());
            formData.append("cadastralNumber", cadastralNumber.val());
            formData.append("plotDescription", plotDescription.val());
            var filesElement = files[0].files;
            for (var i = 0; i < filesElement.length; i++) {
                formData.append("files", filesElement[i]);
            }
            formData.append("administrationComment", administrationComment.val());
            var publicationStatus = $("#publicationStatus");
            var codeObject = $("#codeObject");
            var codeBranch = $("#codeBranch");
            var codeStaff = $("#codeStaff");
            var landmark = $("#landmark");
            var price = $("#price");
            var propertyHouseType = $("#propertyType");
            var plotAreaTotal = $("#plotAreaTotal");
            var plotAreaFree = $("#plotAreaFree");
            var landOwnershipPresent = $("#landOwnershipPresent");
            var plotPurposeType = $("#plotPurposeType");
            var houseQuantity = $("#houseQuantity");
            var floorQuantity = $("#floorQuantity");
            var roomQuantity = $("#roomQuantity");
            var bedroomQuantity = $("#bedroomQuantity");
            var roomMeters = $("#myNumberInput");
            var areaTotal = $("#areaTotal");
            var areaLiving = $("#areaLiving");
            var areaKitchen = $("#areaKitchen");
            var lastContactDate = $("#lastContactDate");
            var vnp = $("#vnp");
            var vnpExpirationDate = $("#vnpExpirationDate");
            var informationSource = $("#informationSource");
            var bargain = $("#bargain");
            var exclusive = $("#exclusive");
            var urgent = $("#urgent");
            var free = $("#free");
            var open = $("#open");
            var intermediary = $("#intermediary");
            var descriptionUk = $("#descriptionUk");
            var advertisementHeadlineUk = $("#advertisementHeadlineUk");
            var advertisementTextUk = $("#advertisementTextUk");
            var descriptionRu = $("#descriptionRu");
            var advertisementHeadlineRu = $("#advertisementHeadlineRu");
            var advertisementTextRu = $("#advertisementTextRu");
            var descriptionEn = $("#descriptionEn");
            var advertisementHeadlineEn = $("#advertisementHeadlineEn");
            var advertisementTextEn = $("#advertisementTextEn");
            var advertisementEnabled = $("#advertisementEnabled");
            var allUploadedFiles = myDropzone.getAcceptedFiles();
            allUploadedFiles.forEach(function (file) {
                formData.append('pictures', file)
            })
            formData.append("publicationStatus", publicationStatus.val());
            formData.append("objectCode", codeObject.val());
            formData.append("branchCode", codeBranch.val());
            formData.append("codeStaff", codeStaff.val());
            formData.append("landmark", landmark.val());
            formData.append("price", price.val());
            formData.append("houseType", propertyHouseType.val());
            formData.append("plotAreaTotal", plotAreaTotal.val());
            formData.append("plotAreaFree", plotAreaFree.val());
            formData.append("landOwnershipPresent", landOwnershipPresent.val());
            formData.append("plotPurposeType", plotPurposeType.val());
            formData.append("houseQuantity", houseQuantity.val());
            formData.append("floorQuantity", floorQuantity.val());
            formData.append("roomQuantity", roomQuantity.val());
            formData.append("bedroomQuantity", bedroomQuantity.val());
            formData.append("roomMeters", roomMeters.val());
            formData.append("areaTotal", areaTotal.val());
            formData.append("areaLiving", areaLiving.val());
            formData.append("areaKitchen", areaKitchen.val());
            formData.append("lastContactDate", lastContactDate.val());
            formData.append("vnp", vnp.is(':checked'));
            formData.append("vnpExpirationDate", vnpExpirationDate.val());
            formData.append("informationSource", informationSource.val());
            formData.append("bargain", bargain.is(':checked'));
            formData.append("exclusive", exclusive.is(':checked'));
            formData.append("urgent", urgent.is(':checked'));
            formData.append("free", free.is(':checked'));
            formData.append("open", open.is(':checked'));
            formData.append("intermediary", intermediary.is(':checked'));
            formData.append("descriptionUk", descriptionUk.val());
            formData.append("advertisementHeadlineUk", advertisementHeadlineUk.val());
            formData.append("advertisementTextUk", advertisementTextUk.val());
            formData.append("description", descriptionRu.val());
            formData.append("advertisementHeadline", advertisementHeadlineRu.val());
            formData.append("advertisementText", advertisementTextRu.val());
            formData.append("descriptionEn", descriptionEn.val());
            formData.append("advertisementHeadlineEn", advertisementHeadlineEn.val());
            formData.append("advertisementTextEn", advertisementTextEn.val());
            formData.append("advertisementEnabled", advertisementEnabled.is(':checked'));

            var wallMaterial = $("#wall_material");
            var wallMaterialUkr = $("#wall_materialUkr");
            var wallMaterialEng = $("#wall_materialEng");
            var stateInterior = $("#stateInterior");
            var stateHouse = $("#stateHouse");
            var kitchenType = $("#kitchenType");
            var bathroomType = $("#bathroomType");
            var gasType = $("#gasType");
            var waterType = $("#waterType");
            var sewageType = $("#sewageType");
            var heatingType = $("#heatingType");
            var ladderType = $("#ladderType");
            var roofType = $("#roofType");
            var floorType = $("#floorType");
            var windowType = $("#windowType");
            var carpentryType = $("#carpentryType");
            var frontDoorType = $("#frontDoorType");

            if (!validateNumber(0, 9999, houseNumber)) return false
            if (!validSelect2(region)) return false
            if (!validSelect2(city)) return false
            if (!validSelect2(district)) return false
            if (!validString("5", "300", street)) return false
            if (!validString("5", "300", streetUkr)) return false
            if (!validString("5", "300", streetEng)) return false
            if (!validSelect2(zone)) return false
            if (!validString("5", "70", ownerName)) return false
            if (!validatePhoneNumber(ownerPhone)) return false
            if (!validateDate(boughtDate)) return false
            if (!validSelect2(ownershipType)) return false
            if (!validString("3", "1000", notes)) return false
            if (cadastralNumber.val().length !== 11) {
                cadastralNumber.css("border", "1px solid #ff0000");
                showToast("Кадастровий номер не коректний", "danger")
                return false
            }
            if (!validString("3", "1000", plotDescription)) return false
            if (!getLastDigitFromPath(window.location.pathname) && !validateFile('housesFiles', [".pdf"])) return false
            if (!validString("3", "1000", administrationComment)) return false
            if (!validSelect2(publicationStatus)) return false
            if (codeObject.val().replace(/\s/g, '').length !== 8) {
                codeObject.css("border", "1px solid #ff0000")
                showToast("Код об'єкта має містити 8 символів", "danger")
                return false
            }
            if (!validateNumber(1, 1000000, codeBranch)) return false
            if (!validString("0", "500", landmark)) return false
            if (!validateNumber(20000, 999999, price)) return false
            if (!validSelect2(propertyHouseType)) return false
            if (!validateNumber(3, 10000, plotAreaTotal)) return false
            if (!validateNumber(3, 10000, plotAreaFree)) return false
            if (!validSelect2(landOwnershipPresent)) return false
            if (!validSelect2(plotPurposeType)) return false
            if (!validateNumber(1, 1000, houseQuantity)) return false
            if (!validateNumber(1, 10000, floorQuantity)) return false
            if (!validateNumber(1, 10000, roomQuantity)) return false
            if (!validateNumber(1, 10000, bedroomQuantity)) return false
            if (!validateNumber(1, 10, roomMeters)) return false
            if (!validateNumber(3, 10000, areaTotal)) return false
            if (!validateNumber(3, 10000, areaLiving)) return false
            if (!validateNumber(3, 10000, areaKitchen)) return false
            if (!validateDate(lastContactDate)) return false
            if (!validateDate(vnpExpirationDate)) return false
            if (!validString("1", "300", informationSource)) return false
            if (!validString("1", "5000", descriptionUk)) return false
            if (!validString("1", "5000", descriptionRu)) return false
            if (!validString("1", "5000", descriptionEn)) return false
            if (!validString("1", "500", advertisementHeadlineUk)) return false
            if (!validString("1", "500", advertisementHeadlineRu)) return false
            if (!validString("1", "500", advertisementHeadlineEn)) return false
            if (!validString("1", "5000", advertisementTextUk)) return false
            if (!validString("1", "5000", advertisementTextRu)) return false
            if (!validString("1", "5000", advertisementTextEn)) return false
            if (!getLastDigitFromPath(window.location.pathname) && allUploadedFiles.length <= 0) {
                showToast("Як мінімум одне фото повино бути завантажене в дропзону", "danger")
                return false
            }
            if (!validString("1", "100", wallMaterial)) return false
            if (!validString("1", "100", wallMaterialUkr)) return false
            if (!validString("1", "100", wallMaterialEng)) return false
            if (!validSelect2(stateInterior)) return false
            if (!validSelect2(stateHouse)) return false
            if (!validSelect2(kitchenType)) return false
            if (!validSelect2(bathroomType)) return false
            if (!validSelect2(gasType)) return false
            if (!validSelect2(waterType)) return false
            if (!validSelect2(sewageType)) return false
            if (!validSelect2(heatingType)) return false
            if (!validSelect2(ladderType)) return false
            if (!validSelect2(roofType)) return false
            if (!validSelect2(floorType)) return false
            if (!validSelect2(windowType)) return false
            if (!validSelect2(carpentryType)) return false
            if (!validSelect2(frontDoorType)) return false

            formData.append("wallMaterial", wallMaterial.val());
            formData.append("wallMaterialUkr", wallMaterialUkr.val());
            formData.append("wallMaterialEng", wallMaterialEng.val());
            formData.append("stateInterior", stateInterior.val());
            formData.append("stateHouse", stateHouse.val());
            formData.append("kitchenType", kitchenType.val());
            formData.append("bathroomType", bathroomType.val());
            formData.append("gasType", gasType.val());
            formData.append("waterType", waterType.val());
            formData.append("sewageType", sewageType.val());
            formData.append("heatingType", heatingType.val());
            formData.append("ladderType", ladderType.val());
            formData.append("roofType", roofType.val());
            formData.append("floorType", floorType.val());
            formData.append("windowType", windowType.val());
            formData.append("carpentryType", carpentryType.val());
            formData.append("frontDoorType", frontDoorType.val());

            return true
        }

        function sendForm() {
            let formData = new FormData();
            if (!validAllInput(formData)) return
            var branchCode = $("#codeBranch");
            var staffCode = $("#codeStaff");

            $.ajax({
                type: 'GET',
                url: '[[@{/realtors/getByCode/}]]' + staffCode.val(),
                success: function (realtor) {
                    if (realtor == '') {
                        showToast("Користувача за таким кодом не знайдено", "danger")
                        staffCode.css("border", "1px solid #ff0000");
                    } else if (realtor.branch.code.toString() !== branchCode.val().toString()) {
                        showToast("Ріелтор не належить вказаному філіалу", "danger")
                        branchCode.css("border", "1px solid #ff0000");
                    } else {
                        $.ajax({
                            type: 'POST',
                            url: '[[@{/houses/add/info}]]',
                            data: formData,
                            contentType: false,
                            processData: false,
                            success: function (response) {
                                showToast(response, "success")
                            },
                            error: function (error) {
                                console.error('Помилка відправки файлів на сервер:', error);
                            }
                        });
                    }
                }
            })
        }

        $(document).ready(function () {
            $('#landOwnershipPresent').select2({
                minimumResultsForSearch: -1,
            })
            var houseId = getLastDigitFromPath(window.location.pathname)
            if (houseId != null) {
                $.ajax({
                    type: "Get",
                    url: '[[@{/houses/getById/}]]' + houseId,
                    success: function (house) {
                        $("#houseNumber").val(house.address.houseNumber)
                        $("#street").val(house.address.street)
                        $("#streetEng").val(house.address.streetEng)
                        $("#streetUkr").val(house.address.streetUkr)
                        $("#owner").val(house.ownerName)
                        $("#telephone").val(house.ownerPhone)
                        $("#dateOfPurchase").val(house.boughtDate.replaceAll('-', '/'))
                        $("#note").val(house.notes)
                        $("#cadastralNumber").val(house.cadastralNumber)
                        $("#ideaPlot").val(house.plotDescription)
                        $("#administrationComment").val(house.administrationComment)

                        $("#codeObject").val(house.objectCode)
                        $("#codeBranch").val(house.realtor.branch.id)
                        $("#codeStaff").val(house.realtor.id)
                        $("#landmark").val(house.landmark)
                        $("#price").val(house.price)
                        $("#plotAreaTotal").val(house.plotAreaTotal)
                        $("#plotAreaFree").val(house.plotAreaFree)
                        $("#houseQuantity").val(house.houseQuantity)
                        $("#floorQuantity").val(house.floorQuantity)
                        $("#roomQuantity").val(house.roomQuantity)
                        $("#bedroomQuantity").val(house.bedroomQuantity)
                        $("#myNumberInput").val(house.roomMeters)
                        $("#areaTotal").val(house.areaTotal)
                        $("#areaLiving").val(house.areaLiving)
                        $("#areaKitchen").val(house.areaKitchen)

                        $("#wall_material").val(house.wallMaterial)
                        $("#wall_materialUkr").val(house.wallMaterialUkr)
                        $("#wall_materialEng").val(house.wallMaterialEng)

                        $("#lastContactDate").val(house.lastContactDate.replaceAll('-', '/'));
                        $("#vnpExpirationDate").val(house.vnpExpirationDate.replaceAll('-', '/'))

                        $("#vnp").prop('checked', house.vnp)
                        $("#informationSource").val(house.informationSource)
                        $('#bargain').prop('checked', house.bargain);
                        $('#exclusive').prop('checked', house.exclusive);
                        $('#urgent').prop('checked', house.urgent);
                        $('#free').prop('checked', house.free);
                        $('#open').prop('checked', house.open);
                        $('#intermediary').prop('checked', house.intermediary);
                        $('#advertisementEnabled').prop('checked', house.advertisementEnabled);

                        $("#descriptionUk").val(house.descriptionUk)
                        $("#advertisementHeadlineUk").val(house.advertisementHeadlineUk)
                        $("#advertisementTextUk").val(house.advertisementTextUk)
                        $("#descriptionRu").val(house.description)
                        $("#advertisementHeadlineRu").val(house.advertisementHeadline)
                        $("#advertisementTextRu").val(house.advertisementText)
                        $("#descriptionEn").val(house.descriptionEn)
                        $("#advertisementHeadlineEn").val(house.advertisementHeadlineEn)
                        $("#advertisementTextEn").val(house.advertisementTextEn)
                        $("#advertisementEnabled").val(house.advertisementEnabled)

                        forSelect2(house.address.zone, house.address.zone, "#topzone", "/enum/topzone")
                        forSelect2(house.ownershipType, house.ownershipType, "#ownership", "/enum/ownership")
                        forSelect2(house.publicationStatus, house.publicationStatus, "#publicationStatus", "/enum/publicationStatus")
                        forSelect2(house.houseType, house.houseType, "#propertyType", "/enum/propertyType")
                        forSelect2(house.plotPurposeType, house.plotPurposeType, "#plotPurposeType", "/enum/plotPurposeType")
                        forSelect2(house.stateInterior, house.stateInterior, "#stateInterior", "/enum/stateHouse")
                        forSelect2(house.stateHouse, house.stateHouse, "#stateHouse", "/enum/stateHouse")

                        forSelect2(house.kitchenType, house.kitchenType, "#kitchenType", "/enum/kitchen")
                        forSelect2(house.bathroomType, house.bathroomType, "#bathroomType", "/enum/bathroom")
                        forSelect2(house.gasType, house.gasType, "#gasType", "/enum/gas")
                        forSelect2(house.waterType, house.waterType, "#waterType", "/enum/water")
                        forSelect2(house.sewageType, house.sewageType, "#sewageType", "/enum/sewerage")
                        forSelect2(house.heatingType, house.heatingType, "#heatingType", "/enum/heating")
                        forSelect2(house.ladderType, house.ladderType, "#ladderType", "/enum/ladder")
                        forSelect2(house.roofType, house.roofType, "#roofType", "/enum/roof")
                        forSelect2(house.floorType, house.floorType, "#floorType", "/enum/floor")
                        forSelect2(house.windowType, house.windowType, "#windowType", "/enum/window")
                        forSelect2(house.carpentryType, house.carpentryType, "#carpentryType", "/enum/carpentryType")
                        forSelect2(house.frontDoorType, house.frontDoorType, "#frontDoorType", "/enum/frontDoorType")

                        addressSelect2(house)

                        for (let file of house.files) {
                            var blockForFile = $("#block-for-file");
                            var row = $("<div class='row'></div>");
                            var col1 = $("<div class='col-2'><a href='#' class='text-decoration-none'>" + removeBeforeFirstDot(file) + "</a></div>");
                            col1.find('a').on("click", function () {
                                downloadFileFrom(file);
                            });
                            var col2 = $("<div class='col'><a href='#' class='text-decoration-none for-delete'>х удалить</a></div>");
                            col2.find('a').on("click", function () {
                                deleteFile(this, file);
                            });
                            row.append(col1);
                            row.append(col2);
                            blockForFile.append(row);
                        }
                    }
                })
            } else {
                forSelect2(undefined, undefined, "#topzone", "/enum/topzone")
                forSelect2(undefined, undefined, "#ownership", "/enum/ownership")
                forSelect2(undefined, undefined, "#publicationStatus", "/enum/publicationStatus")
                forSelect2(undefined, undefined, "#propertyType", "/enum/propertyType")
                forSelect2(undefined, undefined, "#plotPurposeType", "/enum/plotPurposeType")
                forSelect2(undefined, undefined, "#stateInterior", "/enum/stateHouse")
                forSelect2(undefined, undefined, "#stateHouse", "/enum/stateHouse")

                forSelect2(undefined, undefined, "#kitchenType", "/enum/kitchen")
                forSelect2(undefined, undefined, "#bathroomType", "/enum/bathroom")
                forSelect2(undefined, undefined, "#gasType", "/enum/gas")
                forSelect2(undefined, undefined, "#waterType", "/enum/water")
                forSelect2(undefined, undefined, "#sewageType", "/enum/sewerage")
                forSelect2(undefined, undefined, "#heatingType", "/enum/heating")
                forSelect2(undefined, undefined, "#ladderType", "/enum/ladder")
                forSelect2(undefined, undefined, "#roofType", "/enum/roof")
                forSelect2(undefined, undefined, "#floorType", "/enum/floor")
                forSelect2(undefined, undefined, "#windowType", "/enum/window")
                forSelect2(undefined, undefined, "#carpentryType", "/enum/carpentryType")
                forSelect2(undefined, undefined, "#frontDoorType", "/enum/frontDoorType")

                addressSelect2()
            }
            new Cleave("#cadastralNumber", {
                blocks: [3, 3, 3],
                numericOnly: true
            })
            new Cleave("#codeObject", {
                blocks: [2, 4, 2],
                numericOnly: true
            })

            var flatpickrDateTimes = document.querySelectorAll(".flatpickr-datetime");

            flatpickrDateTimes.forEach(function (element) {
                element.flatpickr({
                    dateFormat: "Y/m/d"
                });
            });
        })

        function addressSelect2(house) {
            if (house) {
                $("#district").removeAttr("disabled");
                $("#city").removeAttr("disabled");
                forSelect2(house.address.region, house.address.region, "#region", "/enum/region")
                forSelect2(house.address.district, house.address.district, "#district", "/getDistrict/" + house.address.city)
                forSelect2(house.address.city, house.address.city, "#city", "/getCity/" + house.address.region)
            } else {
                $("#region").select2({
                    minimumResultsForSearch: -1,
                    placeholder: "Елемент",
                    ajax: {
                        url: '[[@{/enum/region}]]',
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: data.name};
                                return {id: data, text: data};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            }
            $('#region').on('select2:select', function (e) {
                var element = e.params.data.text
                $("#city").empty();
                $("#city").removeAttr("disabled");

                $("#district").empty();
                $("#district").prop("disabled", true);
                $("#city").select2({
                    minimumResultsForSearch: -1,
                    placeholder: "Елемент",
                    ajax: {
                        url: '[[@{/getCity/}]]' + element,
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: data.name};
                                return {id: data, text: data};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            });
            $('#city').on('select2:select', function (e) {
                var element = e.params.data.text
                $("#district").empty();
                $("#district").removeAttr("disabled");
                $("#district").select2({
                    minimumResultsForSearch: -1,
                    placeholder: "Елемент",
                    ajax: {
                        url: '[[@{/getDistrict/}]]' + element,
                        dataType: 'json',
                        processResults: function (data) {
                            var index = 0;
                            var results = data.map(function (data) {
                                if (data.id) return {id: data.id, text: data.name};
                                return {id: data, text: data};
                            });
                            return {
                                results: results
                            };
                        },
                    }
                })
            });
        }

        const previewTemplate = `<div class="dz-preview dz-file-preview">
<div class="dz-details">
  <div class="dz-thumbnail">
    <img data-dz-thumbnail>
    <span class="dz-nopreview">No preview</span>
    <div class="dz-success-mark"></div>
    <div class="dz-error-mark"></div>
    <div class="dz-error-message"><span data-dz-errormessage></span></div>
    <div class="progress">
      <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuemin="0" aria-valuemax="1000" data-dz-uploadprogress></div>
    </div>
  </div>
  <div class="dz-filename" data-dz-name></div>
  <div class="dz-size" data-dz-size></div>
</div>
</div>`;
        let uploadedFiles = new Map();
        let oldImagesArray = [];
        let currentFiles = 0;
        var myDropzone = new Dropzone("#my-dropzoneInvestor", {
            url: "/uploadFileInvestor",
            acceptedFiles: ".jpg, .png, .icon, .jpeg",
            previewTemplate: previewTemplate,
            parallelUploads: 5,
            maxFilesize: 10,
            addRemoveLinks: true,
            maxFiles: 15,
            autoProcessQueue: true,
            success: function (file, response) {
                console.log("Файл загружен: " + file.name);
                console.log("Ответ сервера: " + response);
                console.log(currentFiles);
                console.log(myDropzone.maxFiles);
                currentFiles++;
                const imageElement = file.previewElement.querySelector("img[data-dz-thumbnail]");
                imageElement.src = file.dataURL;
            }
        })
        myDropzone.on('success', function (file, response) {
            console.log('Файл успешно загружен:', file.name);
            if (oldImagesArray.includes(file.name)) {
                uploadedFiles.set("wrr2142" + file.name, file);
            } else {
                uploadedFiles.set(file.name, file);
            }
        });
        myDropzone.on('removedfile', function (file) {
            console.log('Файл был удален:', file.name);
            currentFiles--;
            if (uploadedFiles.has(file.name)) {
                uploadedFiles.delete(file.name);
            } else {
                if (file.description) {
                    $.ajax({
                        url: "[[@{/houses/deletePicture/}]]" + getLastDigitFromPath(window.location.pathname),
                        method: "Delete",
                        data: {
                            url: file.description,
                        },
                        success: function (response) {
                            showToast(response, "success")
                        },
                        error: function (error) {
                            console.error("Помилка при отриманні списку файлів: ", error);
                        }
                    });
                }
                console.log('Файл не найден в uploadedFiles Map.');
                oldImagesArray = oldImagesArray.filter(function (item) {
                    return item !== file.name;
                });
                console.log(oldImagesArray);
            }
            updateDropzoneMaxFiles()
        });
        myDropzone.on("addedfile", function (file) {
            console.log("Начало загрузки файла: " + file.name);

        });
        myDropzone.on('queuecomplete', function () {
            console.log('Загрузка всех файлов завершена.');
        });
        if (getLastDigitFromPath(window.location.pathname)) {
            $.ajax({
                url: "[[@{/houses/getPicture/}]]" + getLastDigitFromPath(window.location.pathname),
                method: "GET",
                success: function (files) {
                    files.forEach(function (file) {
                        var mockFile = {
                            name: removeBeforeFirstDot(file.originUrl),
                            size: file.size,
                            description: file.originUrl
                        };
                        myDropzone.emit("addedfile", mockFile);
                        myDropzone.emit("thumbnail", mockFile, file.url);
                        myDropzone.emit("complete", mockFile);
                    });
                },
                error: function (error) {
                    console.error("Помилка при отриманні списку файлів: ", error);
                }
            });
        }

        function updateDropzoneMaxFiles() {
            const newMaxFiles = (15 - oldImagesArray.length);
            myDropzone.options.maxFiles = newMaxFiles;
        }
    </script>
</section>
</body>
</html>