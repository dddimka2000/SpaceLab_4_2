<!DOCTYPE html>
<html
        lang="en"
        class="light-style layout-navbar-fixed layout-menu-fixed"
        layout:decorate="~{layout.html}" xmlns:layout="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <link rel="icon" type="image/x-icon"
          th:href="@{/img/favicon/1644809631_5-abrakadabra-fun-p-domik-na-belom-fone-12.png}">
    <title data-translate="менеджер_обєкту_від_будівельників"></title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.maskedinput@1.4.1/src/jquery.maskedinput.min.js"
            type="text/javascript"></script>
    <link rel="stylesheet" th:href="@{/vendor/fonts/fontawesome.css}">
    <link rel="stylesheet" th:href="@{/vendor/fonts/tabler-icons.css}">
    <link rel="stylesheet" th:href="@{/vendor/fonts/flag-icons.css}">
    <link rel="stylesheet" th:href="@{/css/demo.css}">
    <link rel="stylesheet" th:href="@{/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}">
    <link rel="stylesheet" th:href="@{/vendor/libs/node-waves/node-waves.css}">
    <link rel="stylesheet" th:href="@{/vendor/libs/typeahead-js/typeahead.css}">
    <link rel="stylesheet" th:href="@{/vendor/libs/select2/select2.css}">
    <link rel="stylesheet" th:href="@{/vendor/libs/formvalidation/dist/css/formValidation.min.css}">
    <link rel="stylesheet" th:href="@{/vendor/libs/animate-css/animate.css}">
    <link rel="stylesheet" th:href="@{/vendor/libs/sweetalert2/sweetalert2.css}">
    <script th:src="@{/vendor/js/helpers.js}"></script>
    <link rel="stylesheet" th:href="@{/vendor/libs/typeahead-js/typeahead.css}">
    <link rel="stylesheet" th:href="@{/vendor/libs/dropzone/dropzone.css}">
    <style>
        .notification {
            position: fixed;
            top: 90px;
            right: 40px; /* Расстояние справа */
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
            transition: opacity 0.5s ease-in-out;
        }

        .notification.hidden {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
<main layout:fragment="content">

    <div class="content-wrapper">
        <div class="container-fluid">
            <br>
            <div class="d-flex justify-content-between flex-sm-row">
                <h4 class="fw-bold mb-2 mb-sm-0" data-translate="newObject">Новый объект</h4>
                <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb" class="d-flex align-items-center">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a th:href="@{/}" data-translate="breadcrumb.home">Главная</a></li>
                        <li class="breadcrumb-item"><a th:href="@{/builder_objects}"
                                                       data-translate="breadcrumb.builder_objects">Объекты от
                            строителей</a></li>
                        <li class="breadcrumb-item active" data-translate="builder_object_creation" aria-current="page"
                            th:href="@{/builder_objects/create}">
                            Создание объекта от строителя
                        </li>
                    </ol>
                </nav>
            </div>
            <hr style="margin: 5px">
            <br>
            <ul class="nav nav-pills mb-3" role="tablist">
                <li class="nav-item">
                    <button id="ruLangSave" class="nav-link active" type="button" aria-selected="true" data-toggle="tab"
                            role="tab"
                            data-bs-toggle="pill" onclick="changeInput('ru')">Ру
                    </button>
                </li>
                <li class="nav-item">
                    <button id="euLangSave" class="nav-link" type="button" aria-selected="false" data-toggle="tab"
                            role="tab"
                            data-bs-toggle="pill" onclick="changeInput('eu')">Eng
                    </button>
                </li>
                <li class="nav-item">
                    <button id="ukrLangSave" class="nav-link" type="button" aria-selected="false" data-toggle="tab"
                            role="tab"
                            data-bs-toggle="pill" onclick="changeInput('ukr')">Укр
                    </button>
                </li>
            </ul>
            <br>
            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-home"
                            type="button" role="tab" aria-controls="pills-home" aria-selected="true"
                            data-translate="main">Основное
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-profile"
                            type="button" role="tab" aria-controls="pills-profile" aria-selected="false"
                            data-translate="gallery">Галерея
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-contact"
                            type="button" role="tab" aria-controls="pills-contact" aria-selected="false"
                            data-translate="layout">Планировки
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                    <div class="row">
                        <div class="col-sm-6 col-lg-3">
                            <div style="display:block;" class="ruContent nameContent">
                                <h6 data-translate="title">Название</h6>
                                <input type="text" class="form-control" name="nameObject" id="nameObject"
                                       data-translate-placeholder="enter_title" placeholder="Введите название объекта">
                            </div>
                            <div style="display:none;" class="euContent nameContent">
                                <h6 data-translate="title">Название</h6>
                                <input type="text" class="form-control" name="nameObjectEu" id="nameObjectEu"
                                       data-translate-placeholder="enter_title" placeholder="Input name">
                            </div>
                            <div style="display:none;" class="ukrContent nameContent">
                                <h6 data-translate="title">Название</h6>
                                <input type="text" class="form-control" name="nameObjectUkr" id="nameObjectUkr"
                                       data-translate-placeholder="enter_title" placeholder="Введіть назву об'єкта">
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <h6 data-translate="region_district">Обл.район</h6>
                            <select class="select2 form-select form-select select2find" name="region"
                                    id="region">
                                <option selected disabled></option>
                                <script th:inline="javascript">
                                    var selectRegionOptions = /*[[${selectRegion}]]*/ [];
                                    for (var i = 0; i < selectRegionOptions.length; i++) {
                                        var entity = selectRegionOptions[i];
                                        document.write('<option value="' + entity + '" data-translate="' + entity.replace(' ', '_') + '">' + entity + '</option>');
                                    }
                                    refreshAllTranslate()
                                </script>
                            </select>

                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <h6 data-translate="city">Нас.пункт</h6>
                            <select class="select2 form-select form-select select2find" name="city" disabled>
                            </select>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <h6 data-translate="district">Район</h6>
                            <select class="select2 form-select form-select select2find" name="district" disabled>
                                <option selected disabled value=""></option>
                            </select></div>
                        <div class="col-1"></div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-sm-6 col-lg-3">
                            <h6 data-translate="topzone">Топозона</h6>
                            <select class="select2 form-select form-select select2find" name="topozone">
                                <option value="" selected></option>
                                <script th:inline="javascript">
                                    var selectRegionOptions = /*[[${selectTopozone}]]*/ [];
                                    for (var i = 0; i < selectRegionOptions.length; i++) {
                                        var entity = selectRegionOptions[i];
                                        document.write('<option value="' + entity + '" data-translate="' + entity.replace(' ', '_') + '">' + entity + '</option>');
                                    }
                                    refreshAllTranslate()
                                </script>
                            </select>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <div style="display:block;" class="ruContent nameContent">
                                <h6 data-translate="street">Улица</h6>
                                <input class="form-control" type="text" name="street" id="street"
                                       placeholder="Введите улицу">
                            </div>
                            <div style="display:none;" class="euContent nameContent">
                                <h6 data-translate="street">Улица</h6>
                                <input class="form-control" type="text" name="streetEu" id="streetEu"
                                       placeholder="Введите улицу">
                            </div>
                            <div style="display:none;" class="ukrContent nameContent">
                                <h6 data-translate="street">Вулиця</h6>
                                <input class="form-control" type="text" name="streetUkr" id="streetUkr"
                                       placeholder="Введите улицу">
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-sm-6 col-lg-2">
                            <h6 data-translate="house_number">Номер дома</h6>
                            <input class="form-control" type="number" name="houseNumber"
                                   placeholder="Введите номер дома" data-translate-placeholder="enter_house_number">
                        </div>
                        <div class="col-sm-6 col-lg-2">
                            <h6 data-translate="section_building">Секция/Корпус</h6>
                            <input class="form-control" type="number" name="section"
                                   data-translate-placeholder="enter_section_building"
                                   placeholder="Введите секцию/корпус">
                        </div>
                        <div class="col-sm-6 col-lg-2">
                            <h6 data-translate="number_of_floors">Этажность</h6>
                            <input class="form-control" type="number" name="floorQuantity"
                                   data-translate-placeholder="enter_floor_count" placeholder="Введите кол-во этажей">
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <h6 data-translate="construction_company">Строительная компания</h6>
                            <select class="select2 form-select form-select select2find" name="nameCompany">
                                <option selected disabled></option>
                                <option value="1">One</option>
                                <option value="2">Two</option>
                                <option value="3">Three</option>
                            </select>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <h6 data-translate="completion_date">Срок сдачи</h6>
                            <select id="buildStatus" class="select2 form-select form-select select2find"
                                    name="buildStatus">
                                <option selected disabled></option>
                                <option th:each="status : ${propertyBuildStatus}"
                                        th:value="${status}"
                                        th:text="${status}"
                                        th:data-translate="${status}"></option>
                            </select>
                        </div>
                    </div>
                    <br>
                    <h6 data-translate="phone">Телефон</h6>
                    <input type="tel" name="telephone" id="telephone" class="form-control"
                           placeholder="+380*********">
                    <br>
                    <h6 data-translate="checkerboard">Шахматка</h6>
                    <input type="file" class="form-control" name="chessboard" id="chessboard" accept=".pdf">
                    <br>
                    <h6 data-translate="installment_conditions">Условия рассрочки</h6>
                    <input type="file" class="form-control" name="installmentTerms" id="installmentTerms" accept=".pdf">
                    <br>
                    <h6 data-translate="price_file">Файл с ценами</h6>
                    <input type="file" class="form-control" name="prices" id="prices" accept=".pdf">
                    <br>
                    <br>
                    <div style="display:block;" class="ruContent nameContent">
                        <h3 data-translate="description">Описание</h3>
                        <textarea class="form-control" style="width: 100%; height: 300px" name="descriptionObject"
                                  data-translate-placeholder="enter_description"></textarea>
                    </div>
                    <div style="display:none;" class="euContent nameContent">
                        <h3 data-translate="description">Описание</h3>
                        <textarea class="form-control" style="width: 100%; height: 300px" name="descriptionObjectEu"
                                  data-translate-placeholder="enter_description"
                                  placeholder="Введите описание"></textarea>
                    </div>
                    <div style="display:none;" class="ukrContent nameContent">
                        <h3 data-translate="description">Описание</h3>
                        <textarea class="form-control" style="width: 100%; height: 300px" name="descriptionObjectUkr"
                                  data-translate-placeholder="enter_description"
                                  placeholder="Введите описание"></textarea>
                    </div>

                    <br>
                    <div style="display:block;" class="ruContent nameContent">
                        <h1 data-translate="promotions">Акция</h1>
                        <input data-translate-placeholder="enter_promotion_title" type="text" name="promotionName"
                               id="promotionName" class="form-control"
                               placeholder="Введите название акции">
                    </div>
                    <div style="display:none;" class="euContent nameContent">
                        <h1 data-translate="promotions">Акция</h1>
                        <input data-translate-placeholder="enter_promotion_title" type="text" name="promotionNameEu"
                               id="promotionNameEu" class="form-control"
                               placeholder="Введите название акции">
                    </div>
                    <div style="display:none;" class="ukrContent nameContent">
                        <h1 data-translate="promotions">Акция</h1>
                        <input data-translate-placeholder="enter_promotion_title" type="text" name="promotionNameUkr"
                               id="promotionNameUkr" class="form-control"
                               placeholder="Введите название акции">
                    </div>
                    <br>
                    <div style="display:block;" class="ruContent nameContent">
                        <h3 data-translate="description">Описание</h3>
                        <textarea style="width: 100%; height: 300px" name="descriptionPromotion"
                                  data-translate-placeholder="enter_description" class="form-control"
                                  placeholder="Введите описание акции"></textarea>
                    </div>
                    <div style="display:none;" class="euContent nameContent">
                        <h3 data-translate="description">Описание</h3>
                        <textarea style="width: 100%; height: 300px" name="descriptionPromotionEu"
                                  data-translate-placeholder="enter_description" class="form-control"
                                  placeholder="Введите описание акции"></textarea>
                    </div>
                    <div style="display:none;" class="ukrContent nameContent">
                        <h3 data-translate="description">Описание</h3>
                        <textarea style="width: 100%; height: 300px" name="descriptionPromotionUkr"
                                  data-translate-placeholder="enter_description" class="form-control"
                                  placeholder="Введите описание акции"></textarea>
                    </div>

                    <br>
                    <input class="form-check-input" type="checkbox" value="true" name="statusPromotion"><span
                        class="checkmark" data-translate="include_promotion">Включить акцию</span>
                </div>
                <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                    <div class="row">
                        <div class="col-12">
                            <div class="card-body">
                                <form action="/upload" class="dropzone needsclick dz-clickable" id="dropzone-basic">
                                    <div class="dz-message needsclick">
                                        <span class="note needsclick"></span>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!--Почему-то не работает без этой фигни скрытой-->
                        <div class="card-body" hidden>
                            <form action="/upload" class="dropzone needsclick dz-clickable" id="dropzone-multi">
                                <div class="dz-message needsclick">
                                    Drop files here or click to upload
                                    <span class="note needsclick">(This is just a demo dropzone. Selected files are <strong>not</strong> actually
                            uploaded.)</span>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                    <div id="card-container">
                        <div class="card" id="card1" style="padding: 20px; margin-top: 20px;">
                            <div style="display:block;" class="ruContent nameContent">
                                <div class="row">
                                    <div class="col-sm-12 col-lg-6">
                                        <h6 data-translate="title">Название</h6>
                                    </div>
                                    <div class="col-sm-12 col-lg-6" style="text-align: right">
                                    </div>
                                </div>
                                <input class="form-control col-sm-12 col-lg-6" type="text" id="nameLayout1"
                                       placeholder="Введите название" data-translate-placeholder="title">
                            </div>
                            <div style="display:none;" class="euContent nameContent">
                                <div class="row">
                                    <div class="col-sm-12 col-lg-6">
                                        <h6 data-translate="title">Название</h6>
                                    </div>
                                    <div class="col-sm-12 col-lg-6" style="text-align: right">
                                    </div>
                                </div>
                                <input class="form-control col-sm-12 col-lg-6" type="text" id="nameLayoutEu1"
                                       placeholder="Введите название" data-translate-placeholder="enter_title">
                            </div>
                            <div style="display:none;" class="ukrContent nameContent">
                                <div class="row">
                                    <div class="col-sm-12 col-lg-6">
                                        <h6 data-translate="title">Название</h6>
                                    </div>
                                    <div class="col-sm-12 col-lg-6" style="text-align: right">
                                    </div>
                                </div>
                                <input class="form-control col-sm-12 col-lg-6" type="text" id="nameLayoutUkr1"
                                       placeholder="Введите название" data-translate-placeholder="title">
                            </div>


                            <br>
                            <div class="row">
                                <div class="col-sm-6 col-lg-2">
                                    <h6 data-translate="price_per_sqm">Цена от (м.кв)</h6>
                                    <input data-translate-placeholder="enter_price" class="form-control" type="number"
                                           id="priceLayout1"
                                           placeholder="Введите цену">
                                </div>
                                <div class="col-sm-6 col-lg-2">
                                    <h6 data-translate="rooms">Комнат</h6>
                                    <input class="form-control" type="number" id="roomsLayout1"
                                           data-translate-placeholder="enter_rooms" placeholder="Введите кол-во комнат">
                                </div>
                                <div class="col-sm-6 col-lg-2">
                                    <h6 data-translate="S_total_area_sqm">S общая (м.кв.)*</h6>
                                    <input class="form-control" type="number" id="areaTotalLayout1"
                                           data-translate-placeholder="enter_total_area"
                                           placeholder="Введите общую площадь">
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <h6 data-translate="enter_living_area">S жилая (м.кв.)*</h6>
                                    <input class="form-control" type="number" id="areaLivingLayout1"
                                           data-translate-placeholder="S_living_area_sqm"
                                           placeholder="Введите жилую площадь">
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <h6 data-translate="S_kitchen_area_sqm">S кухни (м.кв.)*</h6>
                                    <input class="form-control" type="number" id="areaKitchenLayout1"
                                           data-translate-placeholder="enter_kitchen_area"
                                           placeholder="Введите площадь кухни">
                                </div>
                            </div>
                            <br>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" value="" id="statusLayout1">
                                <span class="checkmark" data-translate="show_website">Показать сайт</span>
                            </div>
                            <br>
                            <div style="display:block;" class="ruContent nameContent">
                                <h6 data-translate="description">Описание</h6>
                                <input class="form-control" type="text" id="descriptionLayout1"
                                       data-translate-placeholder="enter_description" placeholder="Введите описание">
                            </div>
                            <div style="display:none;" class="euContent nameContent">
                                <h6 data-translate="description">Описание</h6>
                                <input class="form-control" type="text" id="descriptionLayoutEu1"
                                       data-translate-placeholder="enter_description" placeholder="Введите описание">
                            </div>
                            <div style="display:none;" class="ukrContent nameContent">
                                <h6 data-translate="description">Описание</h6>
                                <input class="form-control" type="text" id="descriptionLayoutUkr1"
                                       data-translate-placeholder="enter_description" placeholder="Введите описание">
                            </div>

                            <br>
                            <div class="row" style="text-align: center">
                                <div class="col-sm-6 col-lg-4">
                                    <img id="previewImage1" style="justify-content: center">
                                    <input type="file" class="form-control" id="inputImage1" accept=".jpg, .jpeg, .png"
                                           onchange="updatePreviewImage(this, 'previewImage1')" style="margin-top: 5px">
                                </div>
                                <div class="col-sm-6 col-lg-4">
                                    <img id="previewImage2" style="justify-content: center">
                                    <input type="file" class="form-control" id="inputImage2" accept=".jpg, .jpeg, .png"
                                           onchange="updatePreviewImage(this, 'previewImage2')" style="margin-top: 5px">
                                </div>
                                <div class="col-sm-6 col-lg-4">
                                    <img id="previewImage3">
                                    <input type="file" class="form-control" id="inputImage3" accept=".jpg, .jpeg, .png"
                                           onchange="updatePreviewImage(this, 'previewImage3')" style="margin-top: 5px">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: right; margin: 20px">
                        <button class="btn btn-submit" onclick="addLayoutCard()" type="button">Добавить планировку
                        </button>
                    </div>
                </div>
            </div>
            <div style="text-align: right; margin: 20px">
                <!--                <button class="btn btn-submit">Отмена</button>-->
                <span>
                <button data-translate="save" class="btn btn-success" hx-trigger="click" onclick="sendForm()">
                Сохранить </button>
            </span>
            </div>
        </div>
    </div>
    <div class="alert alert-warning notification  d-flex align-items-center hidden" role="alert"
         id="notification">

        <strong id="text_notification"></strong>
        <div>
            <span id="notification-message"></span>
        </div>
    </div>
    <script th:src="@{/vendor/libs/dropzone/dropzone.js}"></script>
    <script th:src="@{/js/forms-file-upload.js}"></script>
    <script th:src="@{/vendor/libs/block-ui/block-ui.js}"></script>

    <script th:inline="javascript">
        let langOld = "ru";

        function changeInput(lang) {
            $(".nameContent").css("display", "none")
            $("." + lang + "Content").css("display", "block");
            langOld = lang.toString();
            console.log(langOld)
        }

        function sendForm() {
            $("#full_body").block({
                message: '<div style="display: flex; align-items: center; justify-content: center; height: 100vh;"><div class="pinner-border spinner-border text-primary" role="status" style="height: 10vw; width: 10vw; max-height: 400px; max-width: 400px;"></div></div>',
                css: {
                    backgroundColor: "transparent",
                    border: "0"
                },
                overlayCSS: {
                    backgroundColor: "#000",
                    opacity: 0.5
                }
            })
            let formData = new FormData();
            formData.append("nameObject", $("#nameObject").val());
            formData.append("nameObjectEng", $("#nameObjectEu").val());
            formData.append("nameObjectUkr", $("#nameObjectUkr").val());

            formData.append("region", $("#region").val());
            formData.append("street", $("#street").val());
            formData.append("streetUkr", $("#streetUkr").val());
            formData.append("streetEng", $("#streetEu").val());

            formData.append("district", $('[name="district"]').val());
            formData.append("city", $('[name="city"]').val());
            formData.append("topozone", $('[name="topozone"]').val());
            formData.append("promotionName", $("#promotionName").val());
            formData.append("promotionNameEng", $("#promotionNameEu").val());
            formData.append("promotionNameUkr", $("#promotionNameUkr").val());

            formData.append("houseNumber", $('[name="houseNumber"]').val());
            formData.append("section", $('[name="section"]').val());
            formData.append("floorQuantity", $('[name="floorQuantity"]').val());
            formData.append("nameCompany", $('[name="nameCompany"]').val());
            formData.append("buildStatus", $('[name="buildStatus"]').val());
            formData.append("telephone", $('[name="telephone"]').val());
            if ($("#chessboard").prop('files')[0] != null)
                formData.append("chessboardFile", $("#chessboard").prop('files')[0]);
            if ($("#installmentTerms").prop('files')[0] != null)
                formData.append("installmentTerms", $("#installmentTerms").prop('files')[0]);
            if ($("#prices").prop('files')[0] != null)
                formData.append("prices", $("#prices").prop('files')[0]);
            formData.append("description", $('[name="descriptionObject"]').val());
            formData.append("descriptionUkr", $('[name="descriptionObjectUkr"]').val());
            formData.append("descriptionEng", $('[name="descriptionObjectEu"]').val());
            formData.append("descriptionPromotion", $('[name="descriptionPromotion"]').val());
            formData.append("descriptionPromotionEng", $('[name="descriptionPromotionEu"]').val());
            formData.append("descriptionPromotionUkr", $('[name="descriptionPromotionUkr"]').val());

            formData.append("statusPromotion", $('[name="statusPromotion"]').prop('checked'));
            let index = 0;

            layoutArray.forEach(function (element) {
                console.log(element);
                let layoutData = {
                    nameLayout: $("#nameLayout" + element).val(),
                    nameLayoutEng: $("#nameLayoutEu" + element).val(),
                    nameLayoutUkr: $("#nameLayoutUkr" + element).val(),
                    priceLayout: $("#priceLayout" + element).val(),
                    roomQuantityLayout: $("#roomsLayout" + element).val(),
                    areaTotalLayout: $("#areaTotalLayout" + element).val(),
                    areaLivingLayout: $("#areaLivingLayout" + element).val(),
                    areaKitchenLayout: $("#areaKitchenLayout" + element).val(),
                    statusLayout: $("#statusLayout" + element).prop('checked'),
                    descriptionLayout: $("#descriptionLayout" + element).val(),
                    descriptionLayoutEng: $("#descriptionLayoutEng" + element).val(),
                    descriptionLayoutUkr: $("#descriptionLayoutUkr" + element).val()

                }
                let inputImage1 = $("#inputImage" + element).prop('files');
                if (inputImage1.length > 0) {
                    layoutData.img1Layout = inputImage1[0];
                }
                let inputImage2 = $("#inputImage" + (element + 1)).prop('files');
                if (inputImage2.length > 0) {
                    layoutData.img2Layout = inputImage2[0];
                }
                let inputImage3 = $("#inputImage" + (element + 2)).prop('files');
                if (inputImage3.length > 0) {
                    layoutData.img3Layout = inputImage3[0];
                }
                for (let key in layoutData) {
                    formData.append(`layoutDTOList[${index}].${key}`, layoutData[key]);
                }
                console.log(layoutData)
                index = index + 1;
            });

            const uploadedFiles = window.uploadedFiles;
            console.log(uploadedFiles);
            let i = 1;
            for (let [fileName, file] of uploadedFiles) {
                if (i > 15) {
                    break;
                }
                formData.append("files[]", file);
                i++;
            }
            console.log(formData.get("files[]"))
            let contextPath =/*[[@{/}]]*/'';
            let url = contextPath.toString() + "builder_objects/create";
            if (!validAllInput(formData)) {
                $("#full_body").unblock();
                return
            }
            $.ajax({
                url: url,
                method: "POST",
                data: formData,
                headers: {'X-XSRF-TOKEN': [[${_csrf.token}]]},
                contentType: false,
                processData: false,
                success: function () {
                    $("#full_body").unblock();
                    showToastWithTranslate("saveObj", "success");
                },
                error: function (xhr, status, error) {
                    $("#full_body").unblock();
                    var errors = JSON.parse(xhr.responseText);
                    let nameObject = $("#nameObject");
                    let nameObjectEng = $("#nameObjectEu");
                    let nameObjectUkr = $("#nameObjectUkr");
                    errors.forEach(function (error) {
                        console.log(error);
                        changeInputValue = 0;
                        if (error === "(Ру)Объект новостроя с таким именем уже существует") {
                            showErrorName(nameObject);
                            if (changeInputValue == 0) {
                                changeInputValue = changeInputValue + 1;
                                $("#ruLangSave").click();
                                console.log("ru click")
                            }
                        } else if (error === "(Англ)Объект новостроя с таким именем уже существует") {
                            showErrorName(nameObjectEng)
                            if (changeInputValue == 0) {
                                changeInputValue = changeInputValue + 1;
                                $("#euLangSave").click();
                                console.log("eu click")
                            }
                        } else if (error === "(Укр)Объект новостроя с таким именем уже существует") {
                            showErrorName(nameObjectUkr)
                            if (changeInputValue == 0) {
                                changeInputValue = changeInputValue + 1;
                                $("#ukrLangSave").click();
                                console.log("ukr click")
                            }
                        } else {
                            showToast(error, "danger");
                        }
                    });
                }
            })

        }

        let changeInputValue = 0;

        function validAllInput() {
            let isValidated = true
            cleanInputs();
            var nameObject = $("#nameObject");
            var nameObjectEng = $("#nameObjectEu");
            var nameObjectUkr = $("#nameObjectUkr");

            var region = $("#region");
            var street = $("#street");
            var streetUkr = $("#streetUkr");
            var streetEng = $("#streetEu");

            var district = $('[name="district"]');
            var city = $('[name="city"]');
            var topozone = $('[name="topozone"]');
            var promotionName = $("#promotionName");
            var promotionNameEng = $("#promotionNameEu");
            var promotionNameUkr = $("#promotionNameUkr");

            var houseNumber = $('[name="houseNumber"]');
            var section = $('[name="section"]');
            var floorQuantity = $('[name="floorQuantity"]');
            var nameCompany = $('[name="nameCompany"]');
            var buildStatus = $('[name="buildStatus"]');
            var telephone = $('[name="telephone"]');
            var description = $('[name="descriptionObject"]');
            var descriptionUkr = $('[name="descriptionObjectUkr"]');
            var descriptionEng = $('[name="descriptionObjectEu"]');
            var descriptionPromotion = $('[name="descriptionPromotion"]');
            var descriptionPromotionEng = $('[name="descriptionPromotionEu"]');
            var descriptionPromotionUkr = $('[name="descriptionPromotionUkr"]');

            if (!validString("1", "31", nameObject)) {
                isValidated = false;
                $("#ruLangSave").click();
            }
            if (!validString("1", "31", nameObjectEng)) {
                isValidated = false
                $("#euLangSave").click();
            }
            if (!validString("1", "31", nameObjectUkr)) {
                isValidated = false
                $("#ukrLangSave").click();
            }
            if (!validSelect2(region)) isValidated = false
            if (!validSelect2(city)) isValidated = false
            if (!validSelect2(district)) isValidated = false
            if (!validString("1", "31", street)) {
                isValidated = false
                $("#ruLangSave").click();
            }
            if (!validString("1", "31", streetUkr)) {
                isValidated = false
                $("#ukrLangSave").click();
            }
            if (!validString("1", "31", streetEng)) {
                isValidated = false
                $("#euLangSave").click();
            }
            if (!validSelect2(topozone)) isValidated = false
            if (!validString("1", "31", promotionName)) {
                isValidated = false;
                $("#ruLangSave").click();
            }
            if (!validString("1", "31", promotionNameEng)) {
                isValidated = false;
                $("#euLangSave").click();
            }
            if (!validString("1", "31", promotionNameUkr)) {
                isValidated = false;
                $("#ukrLangSave").click();
            }
            if (!validateNumber(0, 9999, houseNumber)) isValidated = false;
            if (!validateNumber(0, 9999, section)) isValidated = false;
            if (!validateNumber(0, 201, floorQuantity)) isValidated = false;
            if (!validSelect2(nameCompany)) isValidated = false
            if (!validSelect2(buildStatus)) isValidated = false
            if (!validatePhoneNumber(telephone)) isValidated = false
            if (!validString("1", "5000", description)) {
                isValidated = false;
                $("#ruLangSave").click();
            }
            if (!validString("1", "5000", descriptionUkr)) {
                isValidated = false;
                $("#ukrLangSave").click();
            }
            if (!validString("1", "5000", descriptionEng)) {
                isValidated = false;
                $("#euLangSave").click();
            }
            if (!validString("1", "5000", descriptionPromotion)) {
                isValidated = false
                $("#ruLangSave").click();
            }
            if (!validString("1", "5000", descriptionPromotionEng)) {
                isValidated = false
                $("#euLangSave").click();
            }
            if (!validString("1", "5000", descriptionPromotionUkr)) {
                isValidated = false
                $("#ukrLangSave").click();
            }

            layoutArray.forEach(function (element) {
                if (!validString("1", "31", $("#nameLayout" + element))) {
                    isValidated = false;
                    $("#ruLangSave").click();
                }
                if (!validString("1", "31", $("#nameLayoutEu" + element))) {
                    isValidated = false;
                    $("#euLangSave").click();
                }
                if (!validString("1", "31", $("#nameLayoutUkr" + element))) {
                    isValidated = false;
                    $("#ukrLangSave").click();
                }
                if (!validateNumber(1, 100000001, $("#priceLayout" + element))) isValidated = false;
                if (!validateNumber(1, 1000, $("#roomsLayout" + element))) isValidated = false;
                if (!validateNumber(1, 100000, $("#areaTotalLayout" + element))) isValidated = false;
                if (!validateNumber(1, 100000, $("#areaLivingLayout" + element))) isValidated = false;
                if (!validateNumber(1, 100000, $("#areaKitchenLayout" + element))) isValidated = false;
                if (!validString("1", "700", $("#descriptionLayout" + element))) {
                    isValidated = false;
                    $("#ruLangSave").click();
                }
                if (!validString("1", "700", $("#descriptionLayoutEu" + element))) {
                    isValidated = false;
                    $("#euLangSave").click();
                }
                if (!validString("1", "700", $("#descriptionLayoutUkr" + element))) {
                    isValidated = false;
                    $("#ukrLangSave").click();
                }

                if (!$("#previewImage" + element).attr("src")) {
                    if (!validateFile('inputImage' + element, ['.jpeg', '.jpg', '.png'])) isValidated = false
                }
                if (!$("#previewImage" + (element + 1)).attr("src")) {
                    if (!validateFile('inputImage' + (element + 1), ['.jpeg', '.jpg', '.png'])) isValidated = false
                }
                if (!$("#previewImage" + (element + 2)).attr("src")) {
                    if (!validateFile('inputImage' + (element + 2), ['.jpeg', '.jpg', '.png'])) isValidated = false
                }

            })
            countError = 0;
            console.log(isValidated)
            return isValidated
        }


        let imgMaxId = 4;

        function updatePreviewImage(input, imgId) {
            if (input.files && input.files[0]) {
                var file = input.files[0];
                if (file.type.startsWith('image/')) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#' + imgId).removeAttr('hidden');
                        $('#' + imgId).attr('src', e.target.result);
                        $('#' + imgId).addClass('d-block w-px-250 h-px-250 rounded mx-auto');
                        if (imgId > imgMaxId) {
                            imgMaxId = imgId;
                        }
                    }
                    reader.readAsDataURL(file);
                } else {
                    input.value = '';
                    showNotification("Warning!", "Только изображения", false)
                }
            }
        }

        let layoutArray = [1];

        function addLayoutCard() {
            let cardContainer = document.getElementById('card-container');
            let newCard = document.createElement('div');
            newCard.className = 'card';
            newCard.style.padding = '20px';
            newCard.style.marginTop = '20px';
            newCard.id = 'card' + imgMaxId;
            layoutArray.push(imgMaxId);
            let text = '';
            if (langOld == 'ru') {
                text += ' <div style="display:block;" class="ruContent nameContent">\n';
            } else {
                text += ' <div style="display:none;" class="ruContent nameContent">\n';
            }
            text += ` <div class="row">
                                              <div class="col-sm-6 col-lg-6">
                <h6 data-translate="title">Название</h6>
           </div>
                 <div class="col-sm-6 col-lg-6" style="text-align: right">
                            <button class="btn btn-danger" onClick="deleteLayout(` + imgMaxId + `)" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash"
                                     width="24"
                                     height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                     stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M4 7l16 0"></path>
                                    <path d="M10 11l0 6"></path>
                                    <path d="M14 11l0 6"></path>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                </svg>
                            </button>
                        </div>
                                               </div>
                                            <input class="form-control col-md-6" type="text" id="nameLayout` + imgMaxId + `"
                                                    placeholder="Введите название" data-translate-placeholder="enter_title">
                                        </div>`;
            newCard.innerHTML += text
            text = '';
            if (langOld == 'eu') {
                text += ' <div style="display:block;" class="euContent nameContent">';

            } else {
                text += '<div style="display:none;" class="euContent nameContent">';
            }
            text += ` <div class="row">
               <div class="col-sm-6 col-lg-6">
                <h6 data-translate="title">Название</h6>
           </div>
                 <div class="col-sm-6 col-lg-6" style="text-align: right">
                            <button class="btn btn-danger" onClick="deleteLayout(` + imgMaxId + `)" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash"
                                     width="24"
                                     height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                     stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M4 7l16 0"></path>
                                    <path d="M10 11l0 6"></path>
                                    <path d="M14 11l0 6"></path>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                </svg>
                            </button>
                        </div>
                                               </div>
                                            <input class="form-control col-md-6" type="text" id="nameLayoutEu` + imgMaxId + `"
                                                    placeholder="Введите название" data-translate-placeholder="enter_title">
                                        </div>`;
            newCard.innerHTML += text;
            text = '';
            if (langOld == 'ukr') {
                text += ' <div style="display:block;" class="ukrContent nameContent">';

            } else {
                text += '<div style="display:none;" class="ukrContent nameContent">';
            }
            text += ` <div class="row">
               <div class="col-sm-6 col-lg-6">
                <h6 data-translate="title">Название</h6>
           </div>

                 <div class="col-6" style="text-align: right">
                            <button class="btn btn-danger" onClick="deleteLayout(` + imgMaxId + `)" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash"
                                     width="24"
                                     height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                     stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M4 7l16 0"></path>
                                    <path d="M10 11l0 6"></path>
                                    <path d="M14 11l0 6"></path>
                                    <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"></path>
                                    <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"></path>
                                </svg>
                            </button>
                        </div>
                                               </div>
                                            <input class="form-control col-md-6" type="text" id="nameLayoutUkr` + imgMaxId + `"
                                                    placeholder="Введите название" data-translate-placeholder="enter_title">
                                        </div>`;
            newCard.innerHTML += text;
            text = '';

            newCard.innerHTML += `
                        <br>
                            <div class="row">
                                <div class="col-sm-6 col-lg-2">
                                    <h6 data-translate="price_per_sqm">Цена от (м.кв)</h6>
                                    <input class="form-control" type="number" id="priceLayout` + imgMaxId + `"
                                           placeholder="Введите цену" data-translate-placeholder="enter_price">
                                </div>
                                <div class="col-sm-6 col-lg-2">
                                    <h6 data-translate="rooms">Комнат</h6>
                                    <input class="form-control" type="number" id="roomsLayout` + imgMaxId + `"
                                           placeholder="Введите кол-во комнат" data-translate-placeholder="enter_rooms">
                                </div>
                                <div class="col-sm-6 col-lg-2">
                                    <h6 data-translate="S_total_area_sqm">S общая (м.кв.)*</h6>
                                    <input class="form-control" type="number" id="areaTotalLayout` + imgMaxId + `"
                                           placeholder="Введите общую площадь" data-translate-placeholder="enter_total_area">
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <h6 data-translate="S_living_area_sqm">S жилая (м.кв.)*</h6>
                                    <input class="form-control" type="number" id="areaLivingLayout` + imgMaxId + `"
                                           placeholder="Введите жилую площадь" data-translate-placeholder="enter_living_area">
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <h6 data-translate="S_kitchen_area_sqm">S кухни (м.кв.)*</h6>
                                    <input class="form-control" type="number" id="areaKitchenLayout` + imgMaxId + `"
                                           placeholder="Введите площадь кухни" data-translate-placeholder="enter_kitchen_area">
                                </div>

                            </div>
                            <br>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" value=""
                                           id="statusLayout` + imgMaxId + `">
                                        <span class="checkmark" data-translate="show_website">Показать сайт</span>
                                </div>
                                <br>
                                    <h6 data-translate="description">Описание</h6>`


            if (langOld == 'ru') {
                text += ' <div style="display:block;" class="ruContent nameContent">\n';
            } else {
                text += ' <div style="display:none;" class="ruContent nameContent">\n';
            }
            text += `<input class="form-control" type="text" id="descriptionLayout` + imgMaxId + `"
                                           placeholder="Введите описание" data-translate-placeholder="enter_description"></div>`
            newCard.innerHTML += text

            text = '';
            if (langOld == 'ukr') {
                text += ' <div style="display:block;" class="ukrContent nameContent">';

            } else {
                text += '<div style="display:none;" class="ukrContent nameContent">';
            }
            text += `<input class="form-control" type="text" id="descriptionLayoutUkr` + imgMaxId + `"
                                           placeholder="Введите описание" data-translate-placeholder="enter_description"></div>`
            newCard.innerHTML += text

            text = '';
            if (langOld == 'eu') {
                text += ' <div style="display:block;" class="euContent nameContent">';

            } else {
                text += '<div style="display:none;" class="euContent nameContent">';
            }
            text += `<input class="form-control" type="text" id="descriptionLayoutEu` + imgMaxId + `"
                                           placeholder="Введите описание" data-translate-placeholder="enter_description"></div>`
            newCard.innerHTML += text


            text = '';


            newCard.innerHTML += `
                                        <br>
                                            <div class="row" style="text-align: center">
                                                <div class="col-sm-6 col-lg-4">
                                                    <img id="previewImage` + (imgMaxId) + `"
                                                         style="justify-content: center">
                                                        <input type="file" class="form-control"  accept=".jpg, .jpeg, .png"
                                                               id="inputImage` + (imgMaxId) + `"
                                                               onChange="updatePreviewImage(this, 'previewImage` + imgMaxId + `')"
                                                               style="margin-top: 5px">
                                                </div>
                                                <div class="col-sm-6 col-lg-4">
                                                    <img id="previewImage` + (imgMaxId + 1) + `"
                                                         style="justify-content: center">
                                                        <input type="file" class="form-control"  accept=".jpg, .jpeg, .png"
                                                               id="inputImage` + (imgMaxId + 1) + `"
                                                               onChange="updatePreviewImage(this, 'previewImage` + (imgMaxId + 1) + `')"
                                                               style="margin-top: 5px">
                                                </div>
                                                <div class="col-sm-6 col-lg-4">
                                                    <img id="previewImage` + (imgMaxId + 2) + `">
                                                        <input type="file" class="form-control"  accept=".jpg, .jpeg, .png"
                                                               id="inputImage` + (imgMaxId + 2) + `"
                                                               onChange="updatePreviewImage(this, 'previewImage` + (imgMaxId + 2) + `')"
                                                               style="margin-top: 5px">
                                                </div>
                                            </div>
                                            `
            cardContainer.appendChild(newCard);
            console.log("Добавление Layout");

            imgMaxId = imgMaxId + 3;
            let allCookies = document.cookie;
            let cookiesArray = allCookies.split("; ");
            let cookies = {};
            for (let i = 0; i < cookiesArray.length; i++) {
                let cookie = cookiesArray[i].split("=");
                cookies[cookie[0]] = cookie[1];
            }
            let selectedLanguage = cookies["selectedLanguage"];
            console.log(selectedLanguage)
            if (selectedLanguage == undefined) {
                document.cookie = "selectedLanguage=ru; path=/";
                selectedLanguage = "ru";
            }
            changeLanguageNav(selectedLanguage);

        }

        function deleteLayout(imgId) {
            let textCard = "#card" + imgId;
            layoutArray = layoutArray.filter(function (item) {
                return item !== imgId;
            });
            $(textCard).remove();
            showNotification("Warning!", "Планировка удалена", false)
            console.log("Удаление Layout");
        }

        // Настройки
        $('#telephone').mask('+380999999999');
        $('[name="city"]').change(function () {
            let selectedValue = $(this).val();
            console.log(selectedValue)
            let contextPath = /*[[@{/}]]*/ '';
            let url = contextPath.toString() + "getDistrict/" + selectedValue.toString();
            console.log(url)
            if (selectedValue.toString() == "") {
                const container2 = $('[name="district"]');
                container2.empty();
                container2.prop('disabled', true);
            } else {
                $.ajax({
                    url: url,
                    method: "GET",
                    data: {
                        selectedValue: selectedValue
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(data)
                        if (Array.isArray(data)) {
                            const container = $('[name="district"]');
                            if (container.is(':disabled')) {
                                container.removeAttr('disabled');
                            }
                            container.empty();
                            let selectionItem = '<option disabled selected value=""></option> ';
                            if (data.length > 0) {
                                data.forEach(function (category) {
                                    selectionItem += '<option data-aos="tr" value="' + category + '" data-translate="' + category.replace(' ', '_') + '">' + category + '</option>';
                                });
                            }
                            container.append(selectionItem);
                        }
                        refreshAllTranslate()
                    },
                    error: function (error) {
                        console.log("Error:", error);
                    }
                });
            }
            refreshAllTranslate()
        });
        $("#region").change(function () {
            let selectedValue = $(this).val();
            console.log(selectedValue)
            let contextPath = /*[[@{/}]]*/ '';
            let url = contextPath.toString() + "getCity/" + selectedValue.toString();
            console.log(url)
            if (selectedValue.toString() == "") {
                const container = $('[name="city"]');
                container.empty();
                container.prop('disabled', true);
                const container2 = $('[name="district"]');
                container2.empty();
                container2.prop('disabled', true);
            } else {
                $.ajax({
                    url: url,
                    method: "GET",
                    data: {
                        selectedValue: selectedValue
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(data)
                        if (Array.isArray(data)) {
                            const container = $('[name="city"]');
                            if (container.is(':disabled')) {
                                container.removeAttr('disabled');
                            }
                            container.empty();
                            let selectionItem = '<option disabled selected value=""></option> ';
                            if (data.length > 0) {
                                data.forEach(function (category) {
                                    selectionItem += '<option value="' + category + '" data-translate="' + category + '">' + category + '</option>';
                                });
                            }
                            container.append(selectionItem);
                            const container2 = $('[name="district"]');
                            container2.empty();
                            container2.prop('disabled', true);
                        }
                        refreshAllTranslate()
                    },
                    error: function (error) {
                        console.log("Error:", error);
                    }
                });
            }
            refreshAllTranslate()
        });

        function showNotification(bigTextMessage, message, isSuccess) {
            const notification = document.getElementById("notification");
            const notificationMessage = document.getElementById("notification-message");

            var element = document.getElementById("text_notification");
            element.textContent = bigTextMessage;

            notificationMessage.textContent = message;
            notification.classList.remove("hidden");
            notification.classList.toggle("alert-success", isSuccess);
            notification.classList.toggle("alert-warning", !isSuccess);
            setTimeout(() => {
                notification.classList.add("hidden");
            }, 5000);
        }


    </script>
</main>

</body>
</html>